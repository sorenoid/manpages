{"name":"sane-scsi","description":"sane-scsi - SCSI adapter tips for scanners","body":"\n\n<h1 align=\"center\">sane-scsi</h1>\n\n\n\n\n\n\n\n\n\n\n\n<hr>\n\n\n<h2>NAME\n<a name=\"NAME\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">sane-scsi -\nSCSI adapter tips for scanners</p>\n\n<h2>DESCRIPTION\n<a name=\"DESCRIPTION\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">This manual\npage contains various operating-system specific tips and\ntricks on how to get scanners with a SCSI interface\nworking.</p>\n\n<h2>GENERAL INFO\n<a name=\"GENERAL INFO\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">For scanners\nwith a SCSI interface, it may be necessary to edit the\nappropriate backend configuration file before using SANE for\nthe first time. For most systems, the configuration file\nshould list the name of the generic SCSI device that the\nscanner is connected to (e.g., under Linux, <i>/dev/sg4</i>\nor <i>/dev/sge</i> is such a generic SCSI device). It is\ncustomary to create a symlink from <i>/dev/scanner</i> to\nthe generic SCSI device that the scanner is connected to. In\nthis case, the configuration file simply lists the line\n<i>/dev/scanner</i>. For a detailed description of each\nbackend&rsquo;s configuration file, please refer to the\nrelevant backend manual page (e.g., <a href=\"https://man.page/5/sane-epson\">sane-epson(5)</a> for\nEpson scanners, <a href=\"https://man.page/5/sane-hp\">sane-hp(5)</a> for HP scanners,\netc.).</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">For some\noperating systems (e.g. Linux and OS/2), there is an\nalternate way of specifying scanner devices. This alternate\nway allows one to identify scanners by the SCSI vendor and\nmodel string and/or by the SCSI device address (consisting\nof bus number, channel number, id, and logical unit number).\nThe syntax for specifying a scanner in this way is:</p>\n\n<p style=\"margin-left:22%; margin-top: 1em\">scsi <i>VENDOR\nMODEL TYPE BUS CHANNEL ID LUN</i></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">where\n<i>VENDOR</i> is the SCSI vendor string, <i>MODEL</i> is the\nSCSI model string, <i>TYPE</i> is type SCSI device type\nstring, <i>BUS</i> is the SCSI bus number (named\n&quot;host&quot; in <i>/proc/scsi/scsi</i>), <i>CHANNEL</i>\nis the SCSI channel number, <i>ID</i> is the SCSI id, and\n<i>LUN</i> is the logical unit number of the scanner device.\nThe first two fields are strings which must be enclosed in\ndouble-quotes if they contain any whitespace. The remaining\nfour fields are non-negative integer numbers. The correct\nvalues for these fields can be found by using operating\nsystem specific tools, e.g. for Linux by looking at the\noutput of the command <i>cat /proc/scsi/scsi</i>. To\nsimplify configuration, a field&rsquo;s value can be\nreplaced with an asterisk symbol\n(&rsquo;&rsquo;*&rsquo;&rsquo;). An asterisk has the effect\nthat any value is allowed for that particular field. This\ncan have the effect that a single scsi-line matches multiple\ndevices. When this happens, each matching device will be\nprobed by the backend one by one and registered if the\nbackend thinks it is a compatible device. For example, the\nline</p>\n\n<p style=\"margin-left:22%; margin-top: 1em\">scsi MUSTEK\nMFS-06000CX Scanner 0 00 03 00</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">would attach\nthe Mustek SCSI scanner with the following /proc/scsi/scsi\nentry:</p>\n\n<p style=\"margin-left:14%; margin-top: 1em\">Host: scsi0\nChannel: 00 Id: 03 Lun: 00 <br>\nVendor: MUSTEK Model: MFS-06000CX Rev: 4.04 <br>\nType: Scanner ANSI SCSI revision: 0</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Usually\nit&rsquo;s sufficient to use vendor and model strings only\nor even only the vendor string. The following example</p>\n\n<p style=\"margin-left:22%; margin-top: 1em\">scsi MUSTEK * *\n* * * *</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">would have the\neffect that all SCSI devices in the system with a vendor\nstring of MUSTEK would be probed and recognized by the\nbackend.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">If the\nremainder of a scsi-string consists of asterisks only, the\nasterisks can be omitted. For example, the following line is\nequivalent to the one specified previously:</p>\n\n<p style=\"margin-left:22%; margin-top: 1em\">scsi MUSTEK</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">On some\nplatforms (e.g., OpenStep), SANE device names take a special\nform. This is explained below in the relevant\nplatform-specific section.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">When using a\nSCSI scanner, ensure that the access permission for the\ngeneric SCSI device is set appropriately. We recommend to\nadd a group &quot;scanner&quot; to <i>/etc/group</i> which\ncontains all users that should have access to the scanner.\nThe permission of the device should then be set to allow\ngroup read and write access. For example, if the scanner is\nat generic SCSI device <i>/dev/sg0</i>, then the following\ntwo commands would set the permission correctly:</p>\n\n<p style=\"margin-left:22%; margin-top: 1em\">$ chgrp scanner\n/dev/sg0 <br>\n$ chmod 660 /dev/sg0</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">When your\nsystem uses the device filesystem (devfs), you have to edit\n<i>/etc/devfs/perms.</i> There you should search the\nline</p>\n\n<p style=\"margin-left:22%; margin-top: 1em\">REGISTER\n^sg[^/]* PERMISSIONS root.root 0600</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">and add a new\nline (eg. for changing permissions of sg4):</p>\n\n<p style=\"margin-left:22%; margin-top: 1em\">REGISTER ^sg4\nPERMISSIONS root.scanner 0660</p>\n\n<h2>FREEBSD INFO\n<a name=\"FREEBSD INFO\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Auto-configuration\nusing the &quot;scsi *&quot; lines in the config files only\nworks if the user running the frontend has read/write access\nto <i>/dev/xpt0</i>. Instead, you can also set a link\n<i>/dev/scanner</i> to the appropriate <i>/dev/uk</i>\ndevice.</p>\n\n<p style=\"margin-left:22%;\">Adaptec AHA1542CF</p>\n\n<p style=\"margin-left:32%;\">Reported to work fine under\nFreeBSD 2.2.2R with the <b>aha</b> driver.</p>\n\n<p style=\"margin-left:22%;\">Adaptec 2940</p>\n\n<p style=\"margin-left:32%;\">Reported to work fine under\nFreeBSD 2.2.2.</p>\n\n<p style=\"margin-left:22%;\">Adaptec 1522</p>\n\n<p style=\"margin-left:32%;\">The scanner probes ok but any\nattempt to access it <i>hangs</i> the entire system. It\nlooks like something is disabling interrupts and then not\nre-enabling them, so it looks like a bug in the FreeBSD\n<b>aic</b> driver.</p>\n\n<p style=\"margin-left:22%;\">Adaptec 1505</p>\n\n<p style=\"margin-left:32%;\">Works on FreeBSD 2.2.5R and 3.0\nusing the <b>aic</b> driver, provided that Plug-and-Play\nsupport is disabled on the card. If there are no <i>uk</i>\ndevices, just do a <i>sh MAKEDEV uk0</i> in the <i>/dev</i>\ndirectory. The scanner should then be accessible as\n<i>/dev/uk0</i> if it was probed during boot.</p>\n\n<p style=\"margin-left:22%;\">Tekram DC390</p>\n\n<p style=\"margin-left:32%;\">Reported to work fine under\nFreeBSD 2.2.2R with the <b>amd</b> driver.</p>\n\n<h2>LINUX INFO\n<a name=\"LINUX INFO\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">First, make\nsure your kernel has SCSI generic support enabled. In\n<i>make xconfig</i>, this shows up under &rsquo;&rsquo;SCSI\nsupport-&gt;SCSI generic support&rsquo;&rsquo;.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">To keep\nscanning times to a minimum, it is strongly recommended to\nuse a large buffer size for the generic SCSI driver. From SG\ndriver version 2.0 on, the maximum buffer size can be\nchanged at program run time, and there is no restriction in\nsize. This driver version is part of the Linux kernels from\nversion 2.2.7 on. If the new SG driver is available some\nbackends (e.g. <a href=\"https://man.page/5/sane-umax\">sane-umax(5)</a>,\n<a href=\"https://man.page/5/sane-mustek\">sane-mustek(5)</a><b>, sane-sharp</b>(5)) automatically\nrequest larger SCSI buffers. If a backend does not\nautomatically request a larger SCSI buffer, set the\nenvironment variable <b>SANE_SG_BUFFERSIZE</b> to the\ndesired buffer size in bytes. It is not recommended to use\nmore than 1 MB, because for large values the probability\nincreases that the SG driver cannot allocate the necessary\nbuffer(s). For ISA cards, even 1 MB might be a too large\nvalue. For a detailed discussion of memory issues of the SG\ndriver, see <i>http://www.torque.net/sg.</i></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">For Linux\nkernels before version 2.2.7 the size of the buffer is only\n32KB. This works, but for many cheaper scanners this causes\nscanning to be slower by about a factor of four than when\nusing a size of 127KB. Linux defines the size of this buffer\nby macro <b>SG_BIG_BUFF</b> in header file\n<i>/usr/include/scsi/sg.h</i>. Unless a system is seriously\nshort on memory, it is recommended to increase this value to\nthe maximum legal value of 128*1024-512=130560 bytes. After\nchanging this value, it is necessary to recompile both the\nkernel (or the SCSI generic module) and the SCSI backends.\nKeep in mind that this is only necessary with older Linux\nkernels.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">A common issue\nwith SCSI scanners is what to do when you booted the system\nwhile the scanner was turned off. In such a case, the\nscanner won&rsquo;t be recognized by the kernel and SANE\nwon&rsquo;t be able to access it. Fortunately, Linux\nprovides a simple mechanism to probe a SCSI device on\ndemand. Suppose you have a scanner connected to SCSI bus 2\nand the scanner has a SCSI id of 5. When the system is up\nand running and the scanner is turned on, you can issue the\ncommand:</p>\n\n<p style=\"margin-left:22%; margin-top: 1em\">echo &quot;scsi\nadd-single-device 2 0 5 0&quot; &gt; /proc/scsi/scsi</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">and the kernel\nwill probe and recognize your scanner (this needs to be done\nas root). It&rsquo;s also possible to dynamically remove a\nSCSI device by using the\n&rsquo;&rsquo;remove-single-device&rsquo;&rsquo; command.\nFor details, please refer to to the SCSI-2.4-HOWTO.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Scanners are\nknown to work with the following SCSI adapters under Linux.\nThis list isn&rsquo;t complete, usually any SCSI adapter\nsupported by Linux should work.</p>\n\n<p style=\"margin-left:22%;\">Acard/Advance SCSI adapters</p>\n\n<p style=\"margin-left:32%;\">Some old versions of the kernel\ndriver (<i>atp870u.c</i>) cut the inquiry information.\nTherefore the scanner couldn&rsquo;t be detected correctly.\nUse a current kernel.</p>\n\n<p style=\"margin-left:22%;\">Adaptec\nAHA-1505/AHA-1542/AHA-2940</p>\n\n<p style=\"margin-left:32%;\">Reported to work fine with\nLinux since v2.0. If you encounter kernel freezes or other\nunexpected behaviour get the latest Linux kernel (2.2.17\nseems to work) or reduce SCSI buffer size to 32 kB.</p>\n\n<p style=\"margin-left:22%;\">ASUS SC200</p>\n\n<p style=\"margin-left:32%;\">Reported to work fine with\nLinux v2.0.</p>\n\n<p style=\"margin-left:22%;\">BusLogic BT958</p>\n\n<p style=\"margin-left:32%;\">To configure the BusLogic card,\nyou may need to follow these instructions (contributed by\nJeremy &lt;jeremy@xxedgexx.com&gt;): During boot, when your\nBusLogic adapter is being initialized, press Ctrl-B to enter\nyour BusLogic adapter setup. Choose the address which your\nBusLogic containing your scanner is located. Choose\n&rsquo;&rsquo;SCSI Device Configuration&rsquo;&rsquo;.\nChoose &rsquo;&rsquo;Scan SCSI Bus&rsquo;&rsquo;. Choose\nwhatever SCSI id that contains your scanner and then choose\n&rsquo;&rsquo;View/Modify SCSI configuration&rsquo;&rsquo;.\nChange &rsquo;&rsquo;Negotiation&rsquo;&rsquo; to\n&rsquo;&rsquo;async&rsquo;&rsquo; and change\n&rsquo;&rsquo;Disconnect&rsquo;&rsquo; to\n&rsquo;&rsquo;off&rsquo;&rsquo;. Press Esc, save, and Esc\nagain until you are asked to reboot.</p>\n\n<p style=\"margin-left:22%;\">NCR/Symbios 53c400/53c400a or\nDomex DTC3181E/L/LE (DTCT436/436P) <br>\nISA SCSI card</p>\n\n<p style=\"margin-left:32%;\">This card is supplied by Mustek\n(and other vendors). It&rsquo;s supported since Linux 2.2.\nThe SCSI cards are supported by the module g_NCR5380.\nIt&rsquo;s necessary to tell the kernel the io port and type\nof card. Example for a 53c400a: <i>modprobe g_NCR5380\nncr_addr=0x280 ncr_53c400a=1 .</i> Once the kernel detects\nthe card, it should work all right. However, while it should\nwork, do not expect good performance out of this card---it\nhas no interrupt line and therefore while a scan is in\nprogress, the system becomes almost unusable. You may change\nthe values of the USLEEP macros in\n<i>drivers/scsi/g_NCR5380.c</i>. Some documentation is in\nthis file and <i>NCR5380.c</i>.</p>\n\n<p style=\"margin-left:22%;\">NCR/Symbios 810</p>\n\n<p style=\"margin-left:32%;\">For some scanners it may be\nnecessary to disable disconnect/reconnect. To achieve this\nuse the option ncr53c8xx=&quot;disc:n&quot;. Some people\nreported that their scanner only worked with the 53c7,8xx\ndriver, not the ncr53c8xx. Try both if you have trouble.\n<br>\nFor Linux kernels before 2.0.33 it may be necessary to\nincrease the SCSI timeout. The default timeout for the Linux\nkernels before 2.0.33 is 10 seconds, which is way too low\nwhen scanning large area. If you get messages of the form\n&rsquo;&rsquo;restart (ncr dead ?)&rsquo;&rsquo; in your\n<i>/var/log/messages</i> file or on the system console,\nit&rsquo;s an indication that the timeout is too short. In\nthis case, find the line &rsquo;&rsquo;if\n(np-&gt;latetime&gt;10)&rsquo;&rsquo; in file\n<i>ncr53c8xx.</i> (normally in directory\n<i>/usr/src/linux/drivers/scsi</i>) and change the constant\n10 to, say, 60 (one minute). Then rebuild the kernel/module\nand try again.</p>\n\n<p style=\"margin-left:22%;\">Tekram DC315</p>\n\n<p style=\"margin-left:32%;\">The driver can be downloaded\nfrom <i>http://www.garloff.de/kurt/linux/dc395/</i>. For\nsome older scanners it may be necessary to disable all the\nmore advanced features by using e.g. <i>modprobe dc395x_trm\ndc395x_trm=7,5,1,32</i>.</p>\n\n<p style=\"margin-left:22%;\">Tekram DC390</p>\n\n<p style=\"margin-left:32%;\">Version 1.11 of the Tekram\ndriver seems to work fine mostly, except that the scan does\nnot terminate properly (it causes a SCSI timeout after 10\nminutes). The generic AM53C974 also seems to work fine and\ndoes not suffer from the timeout problems.</p>\n\n<h2>SOLARIS, OPENSTEP AND NEXTSTEP INFO\n<a name=\"SOLARIS, OPENSTEP AND NEXTSTEP INFO\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Under Solaris,\nOpenStep and NeXTStep, the generic SCSI device name refers\nto a SCSI bus, not to an individual device. For example,\n<i>/dev/sg0</i> refers to the first SCSI bus. To tell SANE\nwhich device to use, append the character\n&rsquo;a&rsquo;+target-id to the special device name. For\nexample, the SCSI device connected to the first SCSI\ncontroller and with target-id 0 would be called\n<i>/dev/sg0a</i>, and the device with target-id 1 on that\nsame bus would be called <i>/dev/sg0b,</i> and so on.</p>\n\n<h2>ENVIRONMENT\n<a name=\"ENVIRONMENT\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>SANE_DEBUG_SANEI_SCSI</b></p>\n\n<p style=\"margin-left:22%;\">If the library was compiled\nwith debug support enabled, this environment variable\ncontrols the debug level for the generic SCSI I/O subsystem.\nE.g., a value of 128 requests all debug output to be printed\nby the backend. A value of 255 also prints kernel messages\nfrom the SCSI subsystem (where available). Smaller levels\nreduce verbosity.</p>\n\n\n<p style=\"margin-left:11%;\"><b>SANE_SCSICMD_TIMEOUT</b></p>\n\n<p style=\"margin-left:22%;\">sets the timeout value for SCSI\ncommands in seconds. Overriding the default value of 120\nseconds should only be necessary for very slow scanners.</p>\n\n<h2>SEE ALSO\n<a name=\"SEE ALSO\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><a href=\"https://man.page/7/sane\">sane(7)</a>,\n<a href=\"https://man.page/1/sane-find-scanner\">sane-find-scanner(1)</a>,\n<b>sane-&quot;backendname&quot;</b>(5),\n<a href=\"https://man.page/5/sane-usb\">sane-usb(5)</a></p>\n\n<h2>AUTHOR\n<a name=\"AUTHOR\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">David\nMosberger</p>\n<hr>\n","headings":["<a href=\"#NAME\">NAME</a>","<a href=\"#DESCRIPTION\">DESCRIPTION</a>","<a href=\"#GENERAL INFO\">GENERAL INFO</a>","<a href=\"#FREEBSD INFO\">FREEBSD INFO</a>","<a href=\"#LINUX INFO\">LINUX INFO</a>","<a href=\"#SOLARIS, OPENSTEP AND NEXTSTEP INFO\">SOLARIS, OPENSTEP AND NEXTSTEP INFO</a>","<a href=\"#ENVIRONMENT\">ENVIRONMENT</a>","<a href=\"#SEE ALSO\">SEE ALSO</a>","<a href=\"#AUTHOR\">AUTHOR</a>"],"level":5}