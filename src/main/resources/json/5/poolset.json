{"name":"poolset","description":"poolset -\npersistent memory pool configuration file format","body":"\n\n<h1 align=\"center\">POOLSET</h1>\n\n\n\n\n\n\n\n\n\n\n<hr>\n\n\n<h2>NAME\n<a name=\"NAME\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">poolset -\npersistent memory pool configuration file format</p>\n\n<h2>SYNOPSIS\n<a name=\"SYNOPSIS\"></a>\n</h2>\n\n\n<pre style=\"margin-left:22%; margin-top: 1em\">mypool.set</pre>\n\n\n<h2>DESCRIPTION\n<a name=\"DESCRIPTION\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Depending on\nthe configuration of the system, the available non-volatile\nmemory space may be divided into multiple memory devices. In\nsuch case, the maximum size of the transactional object\nstore could be limited by the capacity of a single memory\ndevice. Therefore, <a href=\"https://man.page/7/libpmemobj\">libpmemobj(7)</a>,\n<a href=\"https://man.page/7/libpmemblk\">libpmemblk(7)</a> and <a href=\"https://man.page/7/libpmemlog\">libpmemlog(7)</a> allow building\nobject stores spanning multiple memory devices by creation\nof persistent memory pools consisting of multiple files,\nwhere each part of such a <i>pool set</i> may be stored on a\ndifferent pmem-aware filesystem.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">To improve\nreliability and eliminate single point of failure,\n<a href=\"https://man.page/7/libpmemobj\">libpmemobj(7)</a> also allows all the data written to a\npersistent memory pool to be copied to local or remote pool\n<i>replicas</i>, thereby providing backup for the persistent\nmemory pool by producing a <i>mirrored pool set</i>. In\npractice, the pool replicas may be considered as binary\ncopies of the &ldquo;master&rdquo; pool set. Data\nreplication is not supported in <a href=\"https://man.page/7/libpmemblk\">libpmemblk(7)</a> and\n<a href=\"https://man.page/7/libpmemlog\">libpmemlog(7)</a>.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The <i>set</i>\nfile for each type of pool is a plain text file. Lines in\nthe file are formatted as follows:</p>\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p>&bull;</p></td>\n<td width=\"2%\"></td>\n<td width=\"86%\">\n\n\n<p>The first line of the file must be the literal string\n&ldquo;PMEMPOOLSET&rdquo;</p> </td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p>&bull;</p></td>\n<td width=\"2%\"></td>\n<td width=\"86%\">\n\n\n<p>The pool parts are specified, one per line, in the\nformat:</p> </td></tr>\n</table>\n\n<p style=\"margin-left:14%; margin-top: 1em\"><i>size\npathname</i></p>\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p style=\"margin-top: 1em\">&bull;</p></td>\n<td width=\"2%\"></td>\n<td width=\"86%\">\n\n\n<p style=\"margin-top: 1em\"><i>Replica</i> sections, if any,\nstart with the literal string &ldquo;REPLICA&rdquo;. See\n<b>REPLICAS</b>, below, for further details.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p>&bull;</p></td>\n<td width=\"2%\"></td>\n<td width=\"86%\">\n\n\n<p>Pool set options, if any, start with literal string\n<i>OPTION</i>. See <b>POOL SET OPTIONS</b> below for\ndetails.</p> </td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p>&bull;</p></td>\n<td width=\"2%\"></td>\n<td width=\"86%\">\n\n\n<p>Lines starting with &ldquo;#&rdquo; are considered\ncomments and are ignored.</p></td></tr>\n</table>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The <i>size</i>\nmust be compliant with the format specified in IEC 80000-13,\nIEEE 1541 or the Metric Interchange Format. These standards\naccept SI units with obligatory B - kB, MB, GB, ...\n(multiplier by 1000) suffixes, and IEC units with optional\n&ldquo;iB&rdquo; - KiB, MiB, GiB, ..., K, M, G, ... -\n(multiplier by 1024) suffixes.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><i>pathname</i>\nmust be an absolute pathname.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The\n<i>pathname</i> of a part can point to a Device DAX. Device\nDAX is the device-centric analogue of Filesystem DAX. It\nallows memory ranges to be allocated and mapped without need\nof an intervening file system.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Pools created\non Device DAX have additional options and restrictions:</p>\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p style=\"margin-top: 1em\">&bull;</p></td>\n<td width=\"2%\"></td>\n<td width=\"86%\">\n\n\n<p style=\"margin-top: 1em\">The <i>size</i> may be set to\n&ldquo;AUTO&rdquo;, in which case the size of the device\nwill be automatically resolved at pool creation time.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p>&bull;</p></td>\n<td width=\"2%\"></td>\n<td width=\"86%\">\n\n\n<p>To concatenate more than one Device DAX device into a\nsingle pool set, the configured internal alignment of the\ndevices must be 4KiB, unless the <i>SINGLEHDR</i> or\n<i>NOHDRS</i> option is used in the pool set file. See\n<b>POOL SET OPTIONS</b> below for details.</p></td></tr>\n</table>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Please see\n<a href=\"https://man.page/1/ndctl-create-namespace\">ndctl-create-namespace(1)</a> for more information on\nDevice DAX, including how to configure desired\nalignment.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The minimum\nfile size of each part of the pool set is defined as\nfollows:</p>\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p style=\"margin-top: 1em\">&bull;</p></td>\n<td width=\"2%\"></td>\n<td width=\"84%\">\n\n\n<p style=\"margin-top: 1em\">For block pools, as\n<b>PMEMBLK_MIN_PART</b> in <b>&lt;libpmemblk.h&gt;</b></p></td>\n<td width=\"2%\">\n</td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p>&bull;</p></td>\n<td width=\"2%\"></td>\n<td width=\"84%\">\n\n\n<p>For object pools, as <b>PMEMOBJ_MIN_PART</b> in\n<b>&lt;libpmemobj.h&gt;</b></p> </td>\n<td width=\"2%\">\n</td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p>&bull;</p></td>\n<td width=\"2%\"></td>\n<td width=\"84%\">\n\n\n<p>For log pools, as <b>PMEMLOG_MIN_PART</b> in\n<b>&lt;libpmemlog.h&gt;</b></p> </td>\n<td width=\"2%\">\n</td></tr>\n</table>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The net pool\nsize of the pool set is equal to:</p>\n\n<pre style=\"margin-left:22%; margin-top: 1em\">net_pool_size&nbsp;=&nbsp;sum_over_all_parts(page_aligned_part_size&nbsp;-&nbsp;4KiB)&nbsp;+&nbsp;4KiB</pre>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">where</p>\n\n<pre style=\"margin-left:22%; margin-top: 1em\">page_aligned_part_size&nbsp;=&nbsp;part_size&nbsp;&amp;&nbsp;~(page_size&nbsp;-&nbsp;1)</pre>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Note that page\nsize is OS specific. For more information please see\n<a href=\"https://man.page/3/sysconf\">sysconf(3)</a>.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The minimum net\npool size of a pool set is defined as follows:</p>\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p style=\"margin-top: 1em\">&bull;</p></td>\n<td width=\"2%\"></td>\n<td width=\"84%\">\n\n\n<p style=\"margin-top: 1em\">For block pools, as\n<b>PMEMBLK_MIN_POOL</b> in <b>&lt;libpmemblk.h&gt;</b></p></td>\n<td width=\"2%\">\n</td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p>&bull;</p></td>\n<td width=\"2%\"></td>\n<td width=\"84%\">\n\n\n<p>For object pools, as <b>PMEMOBJ_MIN_POOL</b> in\n<b>&lt;libpmemobj.h&gt;</b></p> </td>\n<td width=\"2%\">\n</td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p>&bull;</p></td>\n<td width=\"2%\"></td>\n<td width=\"84%\">\n\n\n<p>For log pools, as <b>PMEMLOG_MIN_POOL</b> in\n<b>&lt;libpmemlog.h&gt;</b></p> </td>\n<td width=\"2%\">\n</td></tr>\n</table>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Here is an\nexample &ldquo;mypool.set&rdquo; file:</p>\n\n<pre style=\"margin-left:22%; margin-top: 1em\">PMEMPOOLSET\nOPTION&nbsp;NOHDRS\n100G&nbsp;/mountpoint0/myfile.part0\n200G&nbsp;/mountpoint1/myfile.part1\n400G&nbsp;/mountpoint2/myfile.part2</pre>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">The files in\nthe set may be created by running one of the following\ncommands. To create a block pool:</p>\n\n<pre style=\"margin-left:22%; margin-top: 1em\">$&nbsp;pmempool&nbsp;create&nbsp;blk&nbsp;&lt;bsize&gt;&nbsp;mypool.set</pre>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">To create a log\npool:</p>\n\n<pre style=\"margin-left:22%; margin-top: 1em\">$&nbsp;pmempool&nbsp;create&nbsp;log&nbsp;mypool.set</pre>\n\n\n<h2>REPLICAS\n<a name=\"REPLICAS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Sections\ndefining replica sets are optional. There may be multiple\nreplica sections.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Local replica\nsections begin with a line containing only the literal\nstring &ldquo;REPLICA&rdquo;, followed by one or more pool\npart lines as described above.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Remote replica\nsections consist of the <i>REPLICA</i> keyword, followed on\nthe same line by the address of a remote host and a relative\npath to a remote pool set file:</p>\n\n<pre style=\"margin-left:22%; margin-top: 1em\">REPLICA&nbsp;[&lt;user&gt;@]&lt;hostname&gt;&nbsp;[&lt;relative-path&gt;/]&lt;remote-pool-set-file&gt;</pre>\n\n\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p style=\"margin-top: 1em\">&bull;</p></td>\n<td width=\"2%\"></td>\n<td width=\"86%\">\n\n\n<p style=\"margin-top: 1em\"><i>hostname</i> must be in the\nformat recognized by the <a href=\"https://man.page/1/ssh\">ssh(1)</a> remote login\nclient</p> </td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p>&bull;</p></td>\n<td width=\"2%\"></td>\n<td width=\"86%\">\n\n\n<p><i>pathname</i> is relative to the root config directory\non the target node - see <a href=\"https://man.page/7/librpmem\">librpmem(7)</a></p></td></tr>\n</table>\n\n<p style=\"margin-left:11%; margin-top: 1em\">There are no\nother lines in the remote replica section - the REPLICA line\ndefines a remote replica entirely.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Here is an\nexample &ldquo;myobjpool.set&rdquo; file with replicas:</p>\n<pre style=\"margin-left:22%; margin-top: 1em\">PMEMPOOLSET\n100G&nbsp;/mountpoint0/myfile.part0\n200G&nbsp;/mountpoint1/myfile.part1\n400G&nbsp;/mountpoint2/myfile.part2\n\n#&nbsp;local&nbsp;replica\nREPLICA\n500G&nbsp;/mountpoint3/mymirror.part0\n200G&nbsp;/mountpoint4/mymirror.part1&nbsp;\n\n\n#&nbsp;remote&nbsp;replica\nREPLICA&nbsp;user@example.com&nbsp;remote-objpool.set</pre>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">The files in\nthe object pool set may be created by running the following\ncommand:</p>\n\n<pre style=\"margin-left:22%; margin-top: 1em\">$&nbsp;pmempool&nbsp;create&nbsp;--layout=&quot;mylayout&quot;&nbsp;obj&nbsp;myobjpool.set</pre>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Remote replica\ncannot have replicas, i.e.&nbsp;a remote pool set file\ncannot define any replicas.</p>\n\n<h2>POOL SET OPTIONS\n<a name=\"POOL SET OPTIONS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Pool set\noptions can appear anywhere after the line with\n<i>PMEMPOOLSET</i> string. Pool set file can contain several\npool set options. The following options are supported:</p>\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p style=\"margin-top: 1em\">&bull;</p></td>\n<td width=\"2%\"></td>\n<td width=\"14%\">\n\n\n<p style=\"margin-top: 1em\"><i>SINGLEHDR</i></p></td>\n<td width=\"72%\">\n</td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p>&bull;</p></td>\n<td width=\"2%\"></td>\n<td width=\"14%\">\n\n\n<p><i>NOHDRS</i></p></td>\n<td width=\"72%\">\n</td></tr>\n</table>\n\n<p style=\"margin-left:11%; margin-top: 1em\">If the\n<i>SINGLEHDR</i> option is used, only the first part in each\nreplica contains the pool part internal metadata. In that\ncase the effective size of a replica is the sum of sizes of\nall its part files decreased once by 4096 bytes.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The\n<i>NOHDRS</i> option can appear only in the remote pool set\nfile, when <b>librpmem</b> does not serve as a means of\nreplication for <b>libpmemobj</b> pool. In that case none of\nthe pool parts contains internal metadata. The effective\nsize of such a replica is the sum of sizes of all its part\nfiles.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Options\n<i>SINGLEHDR</i> and <i>NOHDRS</i> are mutually exclusive.\nIf both are specified in a pool set file, creating or\nopening the pool will fail with an error.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">When using the\n<i>SINGLEHDR</i> or <i>NOHDRS</i> option, one can\nconcatenate more than one Device DAX devices with any\ninternal alignments in one replica.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The\n<i>SINGLEHDR</i> option concerns only replicas that are\nlocal to the pool set file. That is if one wants to create a\npool set with the <i>SINGLEHDR</i> option and with remote\nreplicas, one has to add this option to the local pool set\nfile as well as to every single remote pool set file.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Using the\n<i>SINGLEHDR</i> and <i>NOHDRS</i> options has important\nimplications for data integrity checking and recoverability\nin case of a pool set damage. See <b>pmempool_sync</b>() API\nfor more information about pool set recovery.</p>\n\n<h2>DIRECTORIES\n<a name=\"DIRECTORIES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Providing a\ndirectory as a part&rsquo;s <i>pathname</i> allows the pool\nto dynamically create files and consequently removes the\nuser-imposed limit on the size of the pool.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The <i>size</i>\nargument of a part in a directory poolset becomes the size\nof the address space reservation required for the pool. In\nother words, the size argument is the maximum theoretical\nsize of the mapping. This value can be freely increased\nbetween instances of the application, but decreasing it\nbelow the real required space will result in an error when\nattempting to open the pool.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The directory\nmust NOT contain user created files with extension\n<i>.pmem</i>, otherwise the behavior is undefined. If a file\ncreated by the library within the directory is in any way\naltered (resized, renamed) the behavior is undefined.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">A directory\npoolset must exclusively use directories to specify paths -\ncombining files and directories will result in an error. A\nsingle replica can consist of one or more directories. If\nthere are multiple directories, the address space\nreservation is equal to the sum of the sizes.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The order in\nwhich the files are created is unspecified, but the library\nwill try to maintain equal usage of the directories.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">By default\npools grow in 128 megabyte increments.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Only poolsets\nwith the <i>SINGLEHDR</i> option can safely use\ndirectories.</p>\n\n<h2>NOTES\n<a name=\"NOTES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Creation of all\nthe parts of the pool set and the associated replica sets\ncan be done with the <a href=\"https://man.page/3/pmemobj_create\">pmemobj_create(3)</a>,\n<a href=\"https://man.page/3/pmemblk_create\">pmemblk_create(3)</a> or <a href=\"https://man.page/3/pmemlog_create\">pmemlog_create(3)</a>\nfunction, or by using the <a href=\"https://man.page/1/pmempool\">pmempool(1)</a> utility.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Restoring data\nfrom a local or remote replica can be done by using the\n<a href=\"https://man.page/1/pmempool-sync\">pmempool-sync(1)</a> command or the\n<b>pmempool_sync</b>() API from the <a href=\"https://man.page/7/libpmempool\">libpmempool(7)</a>\nlibrary.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Modifications\nof a pool set file configuration can be done by using the\n<a href=\"https://man.page/1/pmempool-transform\">pmempool-transform(1)</a> command or the\n<b>pmempool_transform</b>() API from the\n<a href=\"https://man.page/7/libpmempool\">libpmempool(7)</a> library.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">When creating a\npool set consisting of multiple files, or when creating a\nreplicated pool set, the <i>path</i> argument passed to\n<a href=\"https://man.page/3/pmemobj_create\">pmemobj_create(3)</a>, <a href=\"https://man.page/3/pmemblk_create\">pmemblk_create(3)</a> or\n<a href=\"https://man.page/3/pmemlog_create\">pmemlog_create(3)</a> must point to the special\n<i>set</i> file that defines the pool layout and the\nlocation of all the parts of the pool set.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">When opening a\npool set consisting of multiple files, or when opening a\nreplicated pool set, the <i>path</i> argument passed to\n<a href=\"https://man.page/3/pmemobj_open\">pmemobj_open(3)</a>, <a href=\"https://man.page/3/pmemblk_open\">pmemblk_open(3)</a> or\n<a href=\"https://man.page/3/pmemlog_open\">pmemlog_open(3)</a> must point to the same <i>set</i>\nfile that was used for pool set creation.</p>\n\n<h2>SEE ALSO\n<a name=\"SEE ALSO\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><a href=\"https://man.page/1/ndctl-create-namespace\">ndctl-create-namespace(1)</a>,\n<a href=\"https://man.page/3/pmemblk_create\">pmemblk_create(3)</a>, <a href=\"https://man.page/3/pmemlog_create\">pmemlog_create(3)</a>,\n<a href=\"https://man.page/3/pmemobj_create\">pmemobj_create(3)</a>, <a href=\"https://man.page/3/sysconf\">sysconf(3)</a>,\n<a href=\"https://man.page/7/libpmemblk\">libpmemblk(7)</a>, <a href=\"https://man.page/7/libpmemlog\">libpmemlog(7)</a>,\n<a href=\"https://man.page/7/libpmemobj\">libpmemobj(7)</a> and <b>&lt;https://pmem.io&gt;</b></p>\n<hr>\n","headings":["<a href=\"#NAME\">NAME</a>","<a href=\"#SYNOPSIS\">SYNOPSIS</a>","<a href=\"#DESCRIPTION\">DESCRIPTION</a>","<a href=\"#REPLICAS\">REPLICAS</a>","<a href=\"#POOL SET OPTIONS\">POOL SET OPTIONS</a>","<a href=\"#DIRECTORIES\">DIRECTORIES</a>","<a href=\"#NOTES\">NOTES</a>","<a href=\"#SEE ALSO\">SEE ALSO</a>"],"level":5}