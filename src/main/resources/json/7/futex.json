{"name":"futex","description":"futex - fast user-space locking","body":"\n\n<h1 align=\"center\">FUTEX</h1>\n\n\n\n\n\n\n\n\n\n<hr>\n\n\n<h2>NAME\n<a name=\"NAME\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">futex - fast\nuser-space locking</p>\n\n<h2>SYNOPSIS\n<a name=\"SYNOPSIS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>#include\n&lt;linux/futex.h&gt;</b></p>\n\n<h2>DESCRIPTION\n<a name=\"DESCRIPTION\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">The Linux\nkernel provides futexes (&quot;Fast user-space\nmutexes&quot;) as a building block for fast user-space\nlocking and semaphores. Futexes are very basic and lend\nthemselves well for building higher-level locking\nabstractions such as mutexes, condition variables,\nread-write locks, barriers, and semaphores.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Most\nprogrammers will in fact not be using futexes directly but\nwill instead rely on system libraries built on them, such as\nthe Native POSIX Thread Library (NPTL) (see\n<a href=\"https://man.page/7/pthreads\">pthreads(7)</a>).</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">A futex is\nidentified by a piece of memory which can be shared between\nprocesses or threads. In these different processes, the\nfutex need not have identical addresses. In its bare form, a\nfutex has semaphore semantics; it is a counter that can be\nincremented and decremented atomically; processes can wait\nfor the value to become positive.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Futex operation\noccurs entirely in user space for the noncontended case. The\nkernel is involved only to arbitrate the contended case. As\nany sane design will strive for noncontention, futexes are\nalso optimized for this situation.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">In its bare\nform, a futex is an aligned integer which is touched only by\natomic assembler instructions. This integer is four bytes\nlong on all platforms. Processes can share this integer\nusing <a href=\"https://man.page/2/mmap\">mmap(2)</a>, via shared memory segments, or because\nthey share memory space, in which case the application is\ncommonly called multithreaded.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>Semantics</b>\n<br>\nAny futex operation starts in user space, but it may be\nnecessary to communicate with the kernel using the\n<a href=\"https://man.page/2/futex\">futex(2)</a> system call.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">To\n&quot;up&quot; a futex, execute the proper assembler\ninstructions that will cause the host CPU to atomically\nincrement the integer. Afterward, check if it has in fact\nchanged from 0 to 1, in which case there were no waiters and\nthe operation is done. This is the noncontended case which\nis fast and should be common.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">In the\ncontended case, the atomic increment changed the counter\nfrom -1 (or some other negative number). If this is\ndetected, there are waiters. User space should now set the\ncounter to 1 and instruct the kernel to wake up any waiters\nusing the <b>FUTEX_WAKE</b> operation.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Waiting on a\nfutex, to &quot;down&quot; it, is the reverse operation.\nAtomically decrement the counter and check if it changed to\n0, in which case the operation is done and the futex was\nuncontended. In all other circumstances, the process should\nset the counter to -1 and request that the kernel wait for\nanother process to up the futex. This is done using the\n<b>FUTEX_WAIT</b> operation.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The\n<a href=\"https://man.page/2/futex\">futex(2)</a> system call can optionally be passed a\ntimeout specifying how long the kernel should wait for the\nfutex to be upped. In this case, semantics are more complex\nand the programmer is referred to <a href=\"https://man.page/2/futex\">futex(2)</a> for more\ndetails. The same holds for asynchronous futex waiting.</p>\n\n<h2>VERSIONS\n<a name=\"VERSIONS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Initial futex\nsupport was merged in Linux 2.5.7 but with different\nsemantics from those described above. Current semantics are\navailable from Linux 2.5.40 onward.</p>\n\n<h2>NOTES\n<a name=\"NOTES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">To reiterate,\nbare futexes are not intended as an easy-to-use abstraction\nfor end users. Implementors are expected to be assembly\nliterate and to have read the sources of the futex\nuser-space library referenced below.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">This man page\nillustrates the most common use of the <a href=\"https://man.page/2/futex\">futex(2)</a>\nprimitives; it is by no means the only one.</p>\n\n<h2>SEE ALSO\n<a name=\"SEE ALSO\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><a href=\"https://man.page/2/clone\">clone(2)</a>,\n<a href=\"https://man.page/2/futex\">futex(2)</a>, <a href=\"https://man.page/2/get_robust_list\">get_robust_list(2)</a>,\n<a href=\"https://man.page/2/set_robust_list\">set_robust_list(2)</a>, <a href=\"https://man.page/2/set_tid_address\">set_tid_address(2)</a>,\n<a href=\"https://man.page/7/pthreads\">pthreads(7)</a></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><i>Fuss,\nFutexes and Furwocks: Fast Userlevel Locking in Linux</i>\n(proceedings of the Ottawa Linux Symposium 2002), futex\nexample library, futex-*.tar.bz2\n<a href=\"ftp://ftp.kernel.org/pub/linux/kernel/people/rusty/\">ftp://ftp.kernel.org/pub/linux/kernel/people/rusty/</a>.</p>\n\n<h2>COLOPHON\n<a name=\"COLOPHON\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">This page is\npart of release 5.10 of the Linux <i>man-pages</i> project.\nA description of the project, information about reporting\nbugs, and the latest version of this page, can be found at\nhttps://www.kernel.org/doc/man-pages/.</p>\n<hr>\n","headings":["<a href=\"#NAME\">NAME</a>","<a href=\"#SYNOPSIS\">SYNOPSIS</a>","<a href=\"#DESCRIPTION\">DESCRIPTION</a>","<a href=\"#VERSIONS\">VERSIONS</a>","<a href=\"#NOTES\">NOTES</a>","<a href=\"#SEE ALSO\">SEE ALSO</a>","<a href=\"#COLOPHON\">COLOPHON</a>"],"level":7}