{"name":"evp_keyexch-ecdh","body":"\n\n<h1 align=\"center\">EVP_KEYEXCH-ECDH</h1>\n\n\n\n\n\n\n\n<hr>\n\n\n<h2>NAME\n<a name=\"NAME\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">EVP_KEYEXCH-ECDH\n- ECDH Key Exchange algorithm support</p>\n\n<h2>DESCRIPTION\n<a name=\"DESCRIPTION\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Key exchange\nsupport for the <b><small>ECDH</small></b> key type.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b><small>ECDH</small>\nKey Exchange parameters</b> <br>\n&quot;ecdh-cofactor-mode&quot; (\n<b><small>OSSL_EXCHANGE_PARAM_EC_ECDH_COFACTOR_MODE</small></b>\n) <br>\n&lt;integer&gt;</p>\n\n<p style=\"margin-left:17%;\">Sets or gets the\n<small>ECDH</small> mode of operation for the associated key\nexchange ctx.</p>\n\n<p style=\"margin-left:17%; margin-top: 1em\">In the context\nof an Elliptic Curve Diffie-Hellman key exchange, this\nparameter can be used to select between the plain\nDiffie-Hellman ( <small>DH</small> ) or Cofactor\nDiffie-Hellman ( <small>CDH</small> ) variants of the key\nexchange algorithm.</p>\n\n<p style=\"margin-left:17%; margin-top: 1em\">When setting,\nthe value should be 1, 0 or -1, respectively forcing\ncofactor mode on, off, or resetting it to the default for\nthe private key associated with the given key exchange\nctx.</p>\n\n<p style=\"margin-left:17%; margin-top: 1em\">When getting,\nthe value should be either 1 or 0, respectively signaling if\nthe cofactor mode is on or off.</p>\n\n<p style=\"margin-left:17%; margin-top: 1em\">See also\n<a href=\"https://man.page/7/provider-keymgmt\">provider-keymgmt(7)</a> for the related\n<b><small>OSSL_PKEY_PARAM_USE_COFACTOR_ECDH</small></b>\nparameter that can be set on a per-key basis.</p>\n\n<p style=\"margin-left:11%;\">&quot;kdf-type&quot; (\n<b><small>OSSL_EXCHANGE_PARAM_KDF_TYPE</small></b> ) &lt;\n<small>UTF8</small> string&gt;</p>\n\n<p style=\"margin-left:17%;\">See &quot;Common Key Exchange\nparameters&quot; in <a href=\"https://man.page/7/provider-keyexch\">provider-keyexch(7)</a>.</p>\n\n<p style=\"margin-left:11%;\">&quot;kdf-digest&quot; (\n<b><small>OSSL_EXCHANGE_PARAM_KDF_DIGEST</small></b> ) &lt;\n<small>UTF8</small> string&gt;</p>\n\n<p style=\"margin-left:17%;\">See &quot;Common Key Exchange\nparameters&quot; in <a href=\"https://man.page/7/provider-keyexch\">provider-keyexch(7)</a>.</p>\n\n<p style=\"margin-left:11%;\">&quot;kdf-digest-props&quot; (\n<b><small>OSSL_EXCHANGE_PARAM_KDF_DIGEST_PROPS</small></b> )\n&lt; <small>UTF8</small> string&gt;</p>\n\n<p style=\"margin-left:17%;\">See &quot;Common Key Exchange\nparameters&quot; in <a href=\"https://man.page/7/provider-keyexch\">provider-keyexch(7)</a>.</p>\n\n<p style=\"margin-left:11%;\">&quot;kdf-outlen&quot; (\n<b><small>OSSL_EXCHANGE_PARAM_KDF_OUTLEN</small></b> )\n&lt;unsigned integer&gt;</p>\n\n<p style=\"margin-left:17%;\">See &quot;Common Key Exchange\nparameters&quot; in <a href=\"https://man.page/7/provider-keyexch\">provider-keyexch(7)</a>.</p>\n\n<p style=\"margin-left:11%;\">&quot;kdf-ukm&quot; (\n<b><small>OSSL_EXCHANGE_PARAM_KDF_UKM</small></b> )\n&lt;octet string&gt;</p>\n\n<p style=\"margin-left:17%;\">See &quot;Common Key Exchange\nparameters&quot; in <a href=\"https://man.page/7/provider-keyexch\">provider-keyexch(7)</a>.</p>\n\n<h2>EXAMPLES\n<a name=\"EXAMPLES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Keys for the\nhost and peer must be generated as shown in\n&quot;Examples&quot; in <b><small>EVP_PKEY-EC</small></b>\n(7) using the same curve name.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The code to\ngenerate a shared secret for the normal case is identical to\n&quot;Examples&quot; in <b><small>EVP_KEYEXCH-DH</small></b>\n(7).</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">To derive a\nshared secret on the host using the host&rsquo;s key and the\npeer&rsquo;s public key but also using X963KDF with a user\nkey material:</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">/* It is\nassumed that the host_key, peer_pub_key and ukm are set up\n*/ <br>\nvoid derive_secret(EVP_PKEY *host_key, EVP_PKEY *peer_key,\n<br>\nunsigned char *ukm, size_t ukm_len) <br>\n{ <br>\nunsigned char secret[64]; <br>\nsize_t out_len = sizeof(secret); <br>\nsize_t secret_len = out_len; <br>\nunsigned int pad = 1; <br>\nOSSL_PARAM params[6]; <br>\nEVP_PKEY_CTX *dctx = EVP_PKEY_CTX_new_from_pkey(NULL,\nhost_key, NULL); <br>\nEVP_PKEY_derive_init(dctx); <br>\nparams[0] =\nOSSL_PARAM_construct_uint(OSSL_EXCHANGE_PARAM_PAD,\n&amp;pad); <br>\nparams[1] =\nOSSL_PARAM_construct_utf8_string(OSSL_EXCHANGE_PARAM_KDF_TYPE,\n<br>\n&quot;X963KDF&quot;, 0); <br>\nparams[2] =\nOSSL_PARAM_construct_utf8_string(OSSL_EXCHANGE_PARAM_KDF_DIGEST,\n<br>\n&quot;SHA1&quot;, 0); <br>\nparams[3] =\nOSSL_PARAM_construct_size_t(OSSL_EXCHANGE_PARAM_KDF_OUTLEN,\n<br>\n&amp;out_len); <br>\nparams[4] =\nOSSL_PARAM_construct_octet_string(OSSL_EXCHANGE_PARAM_KDF_UKM,\n<br>\nukm, ukm_len); <br>\nparams[5] = OSSL_PARAM_construct_end(); <br>\nEVP_PKEY_CTX_set_params(dctx, params); <br>\nEVP_PKEY_derive_set_peer(dctx, peer_pub_key); <br>\nEVP_PKEY_derive(dctx, secret, &amp;secret_len); <br>\n... <br>\nOPENSSL_clear_free(secret, secret_len); <br>\nEVP_PKEY_CTX_free(dctx); <br>\n}</p>\n\n<h2>SEE ALSO\n<a name=\"SEE ALSO\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b><small>EVP_PKEY-EC</small></b>\n(7) <b><small>EVP_PKEY</small></b> (3),\n<a href=\"https://man.page/7/provider-keyexch\">provider-keyexch(7)</a>, <a href=\"https://man.page/7/provider-keymgmt\">provider-keymgmt(7)</a>,\n<a href=\"https://man.page/7/OSSL_PROVIDER-default\">OSSL_PROVIDER-default(7)</a>,\n<b><small>OSSL_PROVIDER-FIPS</small></b> (7),</p>\n\n<h2>COPYRIGHT\n<a name=\"COPYRIGHT\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Copyright\n2020-2022 The OpenSSL Project Authors. All Rights\nReserved.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Licensed under\nthe Apache License 2.0 (the &quot;License&quot;). You may\nnot use this file except in compliance with the License. You\ncan obtain a copy in the file <small>LICENSE</small> in the\nsource distribution or at\n&lt;https://www.openssl.org/source/license.html&gt;.</p>\n<hr>\n","headings":["<a href=\"#NAME\">NAME</a>","<a href=\"#DESCRIPTION\">DESCRIPTION</a>","<a href=\"#EXAMPLES\">EXAMPLES</a>","<a href=\"#SEE ALSO\">SEE ALSO</a>","<a href=\"#COPYRIGHT\">COPYRIGHT</a>"],"level":7}