{"name":"evp_keyexch-dh","description":"EVP_KEYEXCH-DH - DH Key Exchange algorithm support","body":"\n\n<h1 align=\"center\">EVP_KEYEXCH-DH</h1>\n\n\n\n\n\n\n\n<hr>\n\n\n<h2>NAME\n<a name=\"NAME\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">EVP_KEYEXCH-DH\n- DH Key Exchange algorithm support</p>\n\n<h2>DESCRIPTION\n<a name=\"DESCRIPTION\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Key exchange\nsupport for the <b><small>DH</small></b> key type.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b><small>DH</small>\nkey exchange parameters</b> <br>\n&quot;pad&quot; (\n<b><small>OSSL_EXCHANGE_PARAM_PAD</small></b> ) &lt;unsigned\ninteger&gt;</p>\n\n<p style=\"margin-left:17%;\">Sets the padding mode for the\nassociated key exchange ctx. Setting a value of 1 will turn\npadding on. Setting a value of 0 will turn padding off. If\npadding is off then the derived shared secret may be smaller\nthan the largest possible secret size. If padding is on then\nthe derived shared secret will have its first bytes filled\nwith zeros where necessary to make the shared secret the\nsame size as the largest possible secret size. The padding\nmode parameter is ignored (and padding implicitly enabled)\nwhen the <small>KDF</small> type is set to\n&quot;X942KDF-ASN1&quot; (\n<b><small>OSSL_KDF_NAME_X942KDF_ASN1</small></b> ).</p>\n\n<p style=\"margin-left:11%;\">&quot;kdf-type&quot; (\n<b><small>OSSL_EXCHANGE_PARAM_KDF_TYPE</small></b> ) &lt;\n<small>UTF8</small> string&gt;</p>\n\n<p style=\"margin-left:17%;\">See &quot;Common Key Exchange\nparameters&quot; in <a href=\"https://man.page/7/provider-keyexch\">provider-keyexch(7)</a>.</p>\n\n<p style=\"margin-left:11%;\">&quot;kdf-digest&quot; (\n<b><small>OSSL_EXCHANGE_PARAM_KDF_DIGEST</small></b> ) &lt;\n<small>UTF8</small> string&gt;</p>\n\n<p style=\"margin-left:17%;\">See &quot;Common Key Exchange\nparameters&quot; in <a href=\"https://man.page/7/provider-keyexch\">provider-keyexch(7)</a>.</p>\n\n<p style=\"margin-left:11%;\">&quot;kdf-digest-props&quot; (\n<b><small>OSSL_EXCHANGE_PARAM_KDF_DIGEST_PROPS</small></b> )\n&lt; <small>UTF8</small> string&gt;</p>\n\n<p style=\"margin-left:17%;\">See &quot;Common Key Exchange\nparameters&quot; in <a href=\"https://man.page/7/provider-keyexch\">provider-keyexch(7)</a>.</p>\n\n<p style=\"margin-left:11%;\">&quot;kdf-outlen&quot; (\n<b><small>OSSL_EXCHANGE_PARAM_KDF_OUTLEN</small></b> )\n&lt;unsigned integer&gt;</p>\n\n<p style=\"margin-left:17%;\">See &quot;Common Key Exchange\nparameters&quot; in <a href=\"https://man.page/7/provider-keyexch\">provider-keyexch(7)</a>.</p>\n\n<p style=\"margin-left:11%;\">&quot;kdf-ukm&quot; (\n<b><small>OSSL_EXCHANGE_PARAM_KDF_UKM</small></b> )\n&lt;octet string&gt;</p>\n\n<p style=\"margin-left:17%;\">See &quot;Common Key Exchange\nparameters&quot; in <a href=\"https://man.page/7/provider-keyexch\">provider-keyexch(7)</a>.</p>\n\n<p style=\"margin-left:11%;\">&quot;cekalg&quot; (\n<b><small>OSSL_KDF_PARAM_CEK_ALG</small></b> ) &lt;octet\nstring ptr&gt;</p>\n\n<p style=\"margin-left:17%;\">See &quot; <small>KDF</small>\nParameters&quot; in <a href=\"https://man.page/7/provider-kdf\">provider-kdf(7)</a>.</p>\n\n<h2>EXAMPLES\n<a name=\"EXAMPLES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">The examples\nassume a host and peer both generate keys using the same\nnamed group (or domain parameters). See &quot;Examples&quot;\nin <b><small>EVP_PKEY-DH</small></b> (7). Both the host and\npeer transfer their public key to each other.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">To convert the\npeer&rsquo;s generated key pair to a public key in\n<small>DER</small> format in order to transfer to the\nhost:</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">EVP_PKEY\n*peer_key; /* It is assumed this contains the peers\ngenerated key */ <br>\nunsigned char *peer_pub_der = NULL; <br>\nint peer_pub_der_len; <br>\npeer_pub_der_len = i2d_PUBKEY(peer_key, &amp;peer_pub_der);\n<br>\n... <br>\nOPENSSL_free(peer_pub_der);</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">To convert the\nreceived peer&rsquo;s public key from <small>DER</small>\nformat on the host:</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">const unsigned\nchar *pd = peer_pub_der; <br>\nEVP_PKEY *peer_pub_key = d2i_PUBKEY(NULL, &amp;pd,\npeer_pub_der_len); <br>\n... <br>\nEVP_PKEY_free(peer_pub_key);</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">To derive a\nshared secret on the host using the host&rsquo;s key and the\npeer&rsquo;s public key:</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">/* It is\nassumed that the host_key and peer_pub_key are set up */\n<br>\nvoid derive_secret(EVP_KEY *host_key, EVP_PKEY\n*peer_pub_key) <br>\n{ <br>\nunsigned int pad = 1; <br>\nOSSL_PARAM params[2]; <br>\nunsigned char *secret = NULL; <br>\nsize_t secret_len = 0; <br>\nEVP_PKEY_CTX *dctx = EVP_PKEY_CTX_new_from_pkey(NULL,\nhost_key, NULL); <br>\nEVP_PKEY_derive_init(dctx); <br>\n/* Optionally set the padding */ <br>\nparams[0] =\nOSSL_PARAM_construct_uint(OSSL_EXCHANGE_PARAM_PAD,\n&amp;pad); <br>\nparams[1] = OSSL_PARAM_construct_end(); <br>\nEVP_PKEY_CTX_set_params(dctx, params); <br>\nEVP_PKEY_derive_set_peer(dctx, peer_pub_key); <br>\n/* Get the size by passing NULL as the buffer */ <br>\nEVP_PKEY_derive(dctx, NULL, &amp;secret_len); <br>\nsecret = OPENSSL_zalloc(secret_len); <br>\nEVP_PKEY_derive(dctx, secret, &amp;secret_len); <br>\n... <br>\nOPENSSL_clear_free(secret, secret_len); <br>\nEVP_PKEY_CTX_free(dctx); <br>\n}</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Very similar\ncode can be used by the peer to derive the same shared\nsecret using the host&rsquo;s public key and the\npeer&rsquo;s generated key pair.</p>\n\n<h2>SEE ALSO\n<a name=\"SEE ALSO\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b><small>EVP_PKEY-DH</small></b>\n(7), <b><small>EVP_PKEY-FFC</small></b> (7),\n<b><small>EVP_PKEY</small></b> (3),\n<a href=\"https://man.page/7/provider-keyexch\">provider-keyexch(7)</a>, <a href=\"https://man.page/7/provider-keymgmt\">provider-keymgmt(7)</a>,\n<a href=\"https://man.page/7/OSSL_PROVIDER-default\">OSSL_PROVIDER-default(7)</a>,\n<b><small>OSSL_PROVIDER-FIPS</small></b> (7),</p>\n\n<h2>COPYRIGHT\n<a name=\"COPYRIGHT\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Copyright\n2020-2022 The OpenSSL Project Authors. All Rights\nReserved.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Licensed under\nthe Apache License 2.0 (the &quot;License&quot;). You may\nnot use this file except in compliance with the License. You\ncan obtain a copy in the file <small>LICENSE</small> in the\nsource distribution or at\n&lt;https://www.openssl.org/source/license.html&gt;.</p>\n<hr>\n","headings":["<a href=\"#NAME\">NAME</a>","<a href=\"#DESCRIPTION\">DESCRIPTION</a>","<a href=\"#EXAMPLES\">EXAMPLES</a>","<a href=\"#SEE ALSO\">SEE ALSO</a>","<a href=\"#COPYRIGHT\">COPYRIGHT</a>"],"level":7}