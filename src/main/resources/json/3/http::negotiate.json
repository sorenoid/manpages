{"name":"http::negotiate","description":"HTTP::Negotiate - choose a variant to serve","body":"\n\n<h1 align=\"center\">HTTP::Negotiate</h1>\n\n\n\n\n\n\n\n\n\n<hr>\n\n\n<h2>NAME\n<a name=\"NAME\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">HTTP::Negotiate\n- choose a variant to serve</p>\n\n<h2>SYNOPSIS\n<a name=\"SYNOPSIS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">use\nHTTP::Negotiate qw(choose); <br>\n# ID QS Content-Type Encoding Char-Set Lang Size <br>\n$variants = <br>\n[['var1', 1.000, 'text/html', undef, 'iso-8859-1', 'en',\n3000], <br>\n['var2', 0.950, 'text/plain', 'gzip', 'us-ascii', 'no',\n400], <br>\n['var3', 0.3, 'image/gif', undef, undef, undef, 43555], <br>\n]; <br>\n@preferred = choose($variants, $request_headers); <br>\n$the_one = choose($variants);</p>\n\n<h2>DESCRIPTION\n<a name=\"DESCRIPTION\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">This module\nprovides a complete implementation of the\n<small>HTTP</small> content negotiation algorithm specified\nin <i>draft-ietf-http-v11-spec-00.ps</i> chapter 12. Content\nnegotiation allows for the selection of a preferred content\nrepresentation based upon attributes of the negotiable\nvariants and the value of the various Accept* header fields\nin the request.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The variants\nare ordered by preference by calling the function\n<i>choose()</i>.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The first\nparameter is reference to an array of the variants to choose\namong. Each element in this array is an array with the\nvalues [$id, $qs, $content_type, $content_encoding,\n$charset, $content_language, $content_length] whose meanings\nare described below. The $content_encoding and\n$content_language can be either a single scalar value or an\narray reference if there are several values.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The second\noptional parameter is either a HTTP::Headers or a\nHTTP::Request object which is searched for\n&quot;Accept*&quot; headers. If this parameter is missing,\nthen the accept specification is initialized from the\n<small>CGI</small> environment variables <small>HTTP_ACCEPT,\nHTTP_ACCEPT_CHARSET, HTTP_ACCEPT_ENCODING</small> and\n<small>HTTP_ACCEPT_LANGUAGE.</small></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">In an array\ncontext, <i>choose()</i> returns a list of [variant\nidentifier, calculated quality, size] tuples. The values are\nsorted by quality, highest quality first. If the calculated\nquality is the same for two variants, then they are sorted\nby size (smallest first). <i>E.g.</i>:</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">(['var1', 1,\n2000], ['var2', 0.3, 512], ['var3', 0.3, 1024]);</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Note that also\nzero quality variants are included in the return list even\nif these should never be served to the client.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">In a scalar\ncontext, it returns the identifier of the variant with the\nhighest score or &quot;undef&quot; if none have non-zero\nquality.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">If the\n$HTTP::Negotiate::DEBUG variable is set to\n<small>TRUE,</small> then a lot of noise is generated on\n<small>STDOUT</small> during evaluation of\n<i>choose()</i>.</p>\n\n<h2>VARIANTS\n<a name=\"VARIANTS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">A variant is\ndescribed by a list of the following values. If the\nattribute does not make sense or is unknown for a variant,\nthen use &quot;undef&quot; instead. <br>\nidentifier</p>\n\n<p style=\"margin-left:15%;\">This is a string that you use\nas the name for the variant. This identifier for the\npreferred variants returned by <i>choose()</i>.</p>\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"3%\">\n\n\n<p>qs</p></td>\n<td width=\"1%\"></td>\n<td width=\"85%\">\n\n\n<p>This is a number between 0.000 and 1.000 that describes\nthe &quot;source quality&quot;. This is what\n<i>draft-ietf-http-v11-spec-00.ps</i> says about this\nvalue:</p> </td></tr>\n</table>\n\n<p style=\"margin-left:15%; margin-top: 1em\">Source quality\nis measured by the content provider as representing the\namount of degradation from the original source. For example,\na picture in <small>JPEG</small> form would have a lower qs\nwhen translated to the <small>XBM</small> format, and much\nlower qs when translated to an ASCII-art representation.\nNote, however, that this is a function of the source - an\noriginal piece of ASCII-art may degrade in quality if it is\ncaptured in <small>JPEG</small> form. The qs values should\nbe assigned to each variant by the content provider; if no\nqs value has been assigned, the default is generally\n&quot;qs=1&quot;.</p>\n\n<p style=\"margin-left:11%;\">content-type</p>\n\n<p style=\"margin-left:15%;\">This is the media type of the\nvariant. The media type does not include a charset\nattribute, but might contain other parameters. Examples\nare:</p>\n\n<p style=\"margin-left:15%; margin-top: 1em\">text/html <br>\ntext/html;version=2.0 <br>\ntext/plain <br>\nimage/gif <br>\nimage/jpg</p>\n\n<p style=\"margin-left:11%;\">content-encoding</p>\n\n<p style=\"margin-left:15%;\">This is one or more content\nencodings that has been applied to the variant. The content\nencoding is generally used as a modifier to the content\nmedia type. The most common content encodings are:</p>\n\n<p style=\"margin-left:15%; margin-top: 1em\">gzip <br>\ncompress</p>\n\n<p style=\"margin-left:11%;\">content-charset</p>\n\n<p style=\"margin-left:15%;\">This is the character set used\nwhen the variant contains text. The charset value should\ngenerally be &quot;undef&quot; or one of these:</p>\n\n<p style=\"margin-left:15%; margin-top: 1em\">us-ascii <br>\niso-8859-1 ... iso-8859-9 <br>\niso-2022-jp <br>\niso-2022-jp-2 <br>\niso-2022-kr <br>\nunicode-1-1 <br>\nunicode-1-1-utf-7 <br>\nunicode-1-1-utf-8</p>\n\n<p style=\"margin-left:11%;\">content-language</p>\n\n<p style=\"margin-left:15%;\">This describes one or more\nlanguages that are used in the variant. Language is\ndescribed like this in\n<i>draft-ietf-http-v11-spec-00.ps</i>: A language is in this\ncontext a natural language spoken, written, or otherwise\nconveyed by human beings for communication of information to\nother human beings. Computer languages are explicitly\nexcluded.</p>\n\n<p style=\"margin-left:15%; margin-top: 1em\">The language\ntags are defined by <small>RFC 3066.</small> Examples\nare:</p>\n\n<p style=\"margin-left:15%; margin-top: 1em\">no Norwegian\n<br>\nen International English <br>\nen-US US English <br>\nen-cockney</p>\n\n<p style=\"margin-left:11%;\">content-length</p>\n\n<p style=\"margin-left:15%;\">This is the number of bytes\nused to represent the content.</p>\n\n<h2>ACCEPT HEADERS\n<a name=\"ACCEPT HEADERS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">The following\nAccept* headers can be used for describing content\npreferences in a request (This description is an edited\nextract from <i>draft-ietf-http-v11-spec-00.ps</i>): <br>\nAccept</p>\n\n<p style=\"margin-left:15%;\">This header can be used to\nindicate a list of media ranges which are acceptable as a\nresponse to the request. The &quot;*&quot; character is used\nto group media types into ranges, with &quot;*/*&quot;\nindicating all media types and &quot;type/*&quot; indicating\nall subtypes of that type.</p>\n\n<p style=\"margin-left:15%; margin-top: 1em\">The parameter q\nis used to indicate the quality factor, which represents the\nuser&rsquo;s preference for that range of media types. The\nparameter mbx gives the maximum acceptable size of the\nresponse content. The default values are: q=1 and\nmbx=infinity. If no Accept header is present, then the\nclient accepts all media types with q=1.</p>\n\n<p style=\"margin-left:15%; margin-top: 1em\">For\nexample:</p>\n\n<p style=\"margin-left:15%; margin-top: 1em\">Accept:\naudio/*;q=0.2;mbx=200000, audio/basic</p>\n\n<p style=\"margin-left:15%; margin-top: 1em\">would mean:\n&quot;I prefer audio/basic (of any size), but send me any\naudio type if it is the best available after an 80%\nmark-down in quality and its size is less than 200000\nbytes&quot;</p>\n\n<p style=\"margin-left:11%;\">Accept-Charset</p>\n\n<p style=\"margin-left:15%;\">Used to indicate what character\nsets are acceptable for the response. The\n&quot;us-ascii&quot; character set is assumed to be\nacceptable for all user agents. If no Accept-Charset field\nis given, the default is that any charset is acceptable.\nExample:</p>\n\n\n<p style=\"margin-left:15%; margin-top: 1em\">Accept-Charset:\niso-8859-1, unicode-1-1</p>\n\n<p style=\"margin-left:11%;\">Accept-Encoding</p>\n\n<p style=\"margin-left:15%;\">Restricts the Content-Encoding\nvalues which are acceptable in the response. If no\nAccept-Encoding field is present, the server may assume that\nthe client will accept any content encoding. An empty\nAccept-Encoding means that no content encoding is\nacceptable. Example:</p>\n\n\n<p style=\"margin-left:15%; margin-top: 1em\">Accept-Encoding:\ncompress, gzip</p>\n\n<p style=\"margin-left:11%;\">Accept-Language</p>\n\n<p style=\"margin-left:15%;\">This field is similar to\nAccept, but restricts the set of natural languages that are\npreferred in a response. Each language may be given an\nassociated quality value which represents an estimate of the\nuser&rsquo;s comprehension of that language. For\nexample:</p>\n\n\n<p style=\"margin-left:15%; margin-top: 1em\">Accept-Language:\nno, en-gb;q=0.8, de;q=0.55</p>\n\n<p style=\"margin-left:15%; margin-top: 1em\">would mean:\n&quot;I prefer Norwegian, but will accept British English\n(with 80% comprehension) or German (with 55%\ncomprehension).</p>\n\n<h2>COPYRIGHT\n<a name=\"COPYRIGHT\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Copyright\n1996,2001 Gisle Aas.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">This library is\nfree software; you can redistribute it and/or modify it\nunder the same terms as Perl itself.</p>\n\n<h2>AUTHOR\n<a name=\"AUTHOR\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Gisle Aas\n&lt;gisle@aas.no&gt;</p>\n<hr>\n","headings":["<a href=\"#NAME\">NAME</a>","<a href=\"#SYNOPSIS\">SYNOPSIS</a>","<a href=\"#DESCRIPTION\">DESCRIPTION</a>","<a href=\"#VARIANTS\">VARIANTS</a>","<a href=\"#ACCEPT HEADERS\">ACCEPT HEADERS</a>","<a href=\"#COPYRIGHT\">COPYRIGHT</a>","<a href=\"#AUTHOR\">AUTHOR</a>"],"level":3}