{"name":"getutent","body":"\n\n<h1 align=\"center\">GETUTENT</h1>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<hr>\n\n\n<h2>NAME\n<a name=\"NAME\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">getutent,\ngetutid, getutline, pututline, setutent, endutent, utmpname\n- access utmp file entries</p>\n\n<h2>SYNOPSIS\n<a name=\"SYNOPSIS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>#include\n&lt;utmp.h&gt;</b></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>struct utmp\n*getutent(void); <br>\nstruct utmp *getutid(const struct utmp *</b><i>ut</i><b>);\n<br>\nstruct utmp *getutline(const struct utmp\n*</b><i>ut</i><b>);</b></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>struct utmp\n*pututline(const struct utmp *</b><i>ut</i><b>);</b></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>void\nsetutent(void); <br>\nvoid endutent(void);</b></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>int\nutmpname(const char *</b><i>file</i><b>);</b></p>\n\n<h2>DESCRIPTION\n<a name=\"DESCRIPTION\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">New\napplications should use the POSIX.1-specified\n&quot;utmpx&quot; versions of these functions; see\nCONFORMING TO.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>utmpname</b>()\nsets the name of the utmp-format file for the other utmp\nfunctions to access. If <b>utmpname</b>() is not used to set\nthe filename before the other functions are used, they\nassume <b>_PATH_UTMP</b>, as defined in\n<i>&lt;paths.h&gt;</i>.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>setutent</b>()\nrewinds the file pointer to the beginning of the utmp file.\nIt is generally a good idea to call it before any of the\nother functions.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>endutent</b>()\ncloses the utmp file. It should be called when the user code\nis done accessing the file with the other functions.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>getutent</b>()\nreads a line from the current file position in the utmp\nfile. It returns a pointer to a structure containing the\nfields of the line. The definition of this structure is\nshown in <a href=\"https://man.page/5/utmp\">utmp(5)</a>.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>getutid</b>()\nsearches forward from the current file position in the utmp\nfile based upon <i>ut</i>. If <i>ut-&gt;ut_type</i> is one\nof <b>RUN_LVL</b>, <b>BOOT_TIME</b>, <b>NEW_TIME</b>, or\n<b>OLD_TIME</b>, <b>getutid</b>() will find the first entry\nwhose <i>ut_type</i> field matches <i>ut-&gt;ut_type</i>. If\n<i>ut-&gt;ut_type</i> is one of <b>INIT_PROCESS</b>,\n<b>LOGIN_PROCESS</b>, <b>USER_PROCESS</b>, or\n<b>DEAD_PROCESS</b>, <b>getutid</b>() will find the first\nentry whose <i>ut_id</i> field matches\n<i>ut-&gt;ut_id</i>.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>getutline</b>()\nsearches forward from the current file position in the utmp\nfile. It scans entries whose <i>ut_type</i> is\n<b>USER_PROCESS</b> or <b>LOGIN_PROCESS</b> and returns the\nfirst one whose <i>ut_line</i> field matches\n<i>ut-&gt;ut_line</i>.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>pututline</b>()\nwrites the <i>utmp</i> structure <i>ut</i> into the utmp\nfile. It uses <b>getutid</b>() to search for the proper\nplace in the file to insert the new entry. If it cannot find\nan appropriate slot for <i>ut</i>, <b>pututline</b>() will\nappend the new entry to the end of the file.</p>\n\n<h2>RETURN VALUE\n<a name=\"RETURN VALUE\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>getutent</b>(),\n<b>getutid</b>(), and <b>getutline</b>() return a pointer to\na <i>struct utmp</i> on success, and NULL on failure (which\nincludes the &quot;record not found&quot; case). This\n<i>struct utmp</i> is allocated in static storage, and may\nbe overwritten by subsequent calls.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">On success\n<b>pututline</b>() returns <i>ut</i>; on failure, it returns\nNULL.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>utmpname</b>()\nreturns 0 if the new name was successfully stored, or -1 on\nfailure.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">In the event of\nan error, these functions <i>errno</i> set to indicate the\ncause.</p>\n\n<h2>ERRORS\n<a name=\"ERRORS\"></a>\n</h2>\n\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p style=\"margin-top: 1em\"><b>ENOMEM</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"26%\">\n\n\n<p style=\"margin-top: 1em\">Out of memory.</p></td>\n<td width=\"52%\">\n</td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>ESRCH</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"26%\">\n\n\n<p>Record not found.</p></td>\n<td width=\"52%\">\n</td></tr>\n</table>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>setutent</b>(),\n<b>pututline</b>(), and the <b>getut*</b>() functions can\nalso fail for the reasons described in <a href=\"https://man.page/2/open\">open(2)</a>.</p>\n\n<h2>FILES\n<a name=\"FILES\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><i>/var/run/utmp</i></p>\n\n<p style=\"margin-left:22%;\">database of currently logged-in\nusers</p>\n\n<p style=\"margin-left:11%;\"><i>/var/log/wtmp</i></p>\n\n<p style=\"margin-left:22%;\">database of past user\nlogins</p>\n\n<h2>ATTRIBUTES\n<a name=\"ATTRIBUTES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">For an\nexplanation of the terms used in this section, see\n<a href=\"https://man.page/7/attributes\">attributes(7)</a>.</p>\n\n\n<p align=\"center\" style=\"margin-top: 1em\"><img src=\"grohtml-3397501.png\" alt=\"Image grohtml-3397501.png\"></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">In the above\ntable, <i>utent</i> in <i>race:utent</i> signifies that if\nany of the functions <b>setutent</b>(), <b>getutent</b>(),\n<b>getutid</b>(), <b>getutline</b>(), <b>pututline</b>(),\n<b>utmpname</b>(), or <b>endutent</b>() are used in parallel\nin different threads of a program, then data races could\noccur.</p>\n\n<h2>CONFORMING TO\n<a name=\"CONFORMING TO\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">XPG2, SVr4.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">In XPG2 and\nSVID 2 the function <b>pututline</b>() is documented to\nreturn void, and that is what it does on many systems (AIX,\nHP-UX). HP-UX introduces a new function <b>_pututline</b>()\nwith the prototype given above for <b>pututline</b>().</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">All these\nfunctions are obsolete now on non-Linux systems.\nPOSIX.1-2001 and POSIX.1-2008, following SUSv1, does not\nhave any of these functions, but instead uses</p>\n\n<p style=\"margin-left:17%; margin-top: 1em\"><b>#include\n&lt;utmpx.h&gt;</b></p>\n\n<p style=\"margin-left:17%; margin-top: 1em\"><b>struct utmpx\n*getutxent(void); <br>\nstruct utmpx *getutxid(const struct utmpx *); <br>\nstruct utmpx *getutxline(const struct utmpx *); <br>\nstruct utmpx *pututxline(const struct utmpx *); <br>\nvoid setutxent(void); <br>\nvoid endutxent(void);</b></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">These functions\nare provided by glibc, and perform the same task as their\nequivalents without the &quot;x&quot;, but use <i>struct\nutmpx</i>, defined on Linux to be the same as <i>struct\nutmp</i>. For completeness, glibc also provides\n<b>utmpxname</b>(), although this function is not specified\nby POSIX.1.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">On some other\nsystems, the <i>utmpx</i> structure is a superset of the\n<i>utmp</i> structure, with additional fields, and larger\nversions of the existing fields, and parallel files are\nmaintained, often <i>/var/*/utmpx</i> and\n<i>/var/*/wtmpx</i>.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Linux glibc on\nthe other hand does not use a parallel <i>utmpx</i> file\nsince its <i>utmp</i> structure is already large enough. The\n&quot;x&quot; functions listed above are just aliases for\ntheir counterparts without the &quot;x&quot; (e.g.,\n<b>getutxent</b>() is an alias for <b>getutent</b>()).</p>\n\n<h2>NOTES\n<a name=\"NOTES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>Glibc\nnotes</b> <br>\nThe above functions are not thread-safe. Glibc adds\nreentrant versions</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>#include\n&lt;utmp.h&gt;</b></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>int\ngetutent_r(struct utmp *</b><i>ubuf</i><b>, struct utmp\n**</b><i>ubufp</i><b>); <br>\nint getutid_r(struct utmp *</b><i>ut</i><b>, <br>\nstruct utmp *</b><i>ubuf</i><b>, struct utmp\n**</b><i>ubufp</i><b>); <br>\nint getutline_r(struct utmp *</b><i>ut</i><b>, <br>\nstruct utmp *</b><i>ubuf</i><b>, struct utmp\n**</b><i>ubufp</i><b>);</b></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Feature Test\nMacro Requirements for glibc (see\n<a href=\"https://man.page/7/feature_test_macros\">feature_test_macros(7)</a>):</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>getutent_r</b>(),\n<b>getutid_r</b>(), <b>getutline_r</b>(): <br>\n_GNU_SOURCE <br>\n|| /* since glibc 2.19: */ _DEFAULT_SOURCE <br>\n|| /* glibc &lt;= 2.19: */ _SVID_SOURCE || _BSD_SOURCE</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">These functions\nare GNU extensions, analogs of the functions of the same\nname without the _r suffix. The <i>ubuf</i> argument gives\nthese functions a place to store their result. On success,\nthey return 0, and a pointer to the result is written in\n<i>*ubufp</i>. On error, these functions return -1. There\nare no utmpx equivalents of the above functions. (POSIX.1\ndoes not specify such functions.)</p>\n\n<h2>EXAMPLES\n<a name=\"EXAMPLES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">The following\nexample adds and removes a utmp record, assuming it is run\nfrom within a pseudo terminal. For usage in a real\napplication, you should check the return values of\n<a href=\"https://man.page/3/getpwuid\">getpwuid(3)</a> and <a href=\"https://man.page/3/ttyname\">ttyname(3)</a>.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">#include\n&lt;string.h&gt; <br>\n#include &lt;stdlib.h&gt; <br>\n#include &lt;pwd.h&gt; <br>\n#include &lt;unistd.h&gt; <br>\n#include &lt;utmp.h&gt; <br>\n#include &lt;time.h&gt;</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">int <br>\nmain(int argc, char *argv[]) <br>\n{ <br>\nstruct utmp entry;</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">system(&quot;echo\nbefore adding entry:;who&quot;);</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">entry.ut_type =\nUSER_PROCESS; <br>\nentry.ut_pid = getpid(); <br>\nstrcpy(entry.ut_line, ttyname(STDIN_FILENO) +\nstrlen(&quot;/dev/&quot;)); <br>\n/* only correct for ptys named /dev/tty[pqr][0-9a-z] */ <br>\nstrcpy(entry.ut_id, ttyname(STDIN_FILENO) +\nstrlen(&quot;/dev/tty&quot;)); <br>\ntime(&amp;entry.ut_time); <br>\nstrcpy(entry.ut_user, getpwuid(getuid())-&gt;pw_name); <br>\nmemset(entry.ut_host, 0, UT_HOSTSIZE); <br>\nentry.ut_addr = 0; <br>\nsetutent(); <br>\npututline(&amp;entry);</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">system(&quot;echo\nafter adding entry:;who&quot;);</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">entry.ut_type =\nDEAD_PROCESS; <br>\nmemset(entry.ut_line, 0, UT_LINESIZE); <br>\nentry.ut_time = 0; <br>\nmemset(entry.ut_user, 0, UT_NAMESIZE); <br>\nsetutent(); <br>\npututline(&amp;entry);</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">system(&quot;echo\nafter removing entry:;who&quot;);</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">endutent();\n<br>\nexit(EXIT_SUCCESS); <br>\n}</p>\n\n<h2>SEE ALSO\n<a name=\"SEE ALSO\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><a href=\"https://man.page/3/getutmp\">getutmp(3)</a>,\n<a href=\"https://man.page/5/utmp\">utmp(5)</a></p>\n\n<h2>COLOPHON\n<a name=\"COLOPHON\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">This page is\npart of release 5.10 of the Linux <i>man-pages</i> project.\nA description of the project, information about reporting\nbugs, and the latest version of this page, can be found at\nhttps://www.kernel.org/doc/man-pages/.</p>\n<hr>\n","headings":["<a href=\"#NAME\">NAME</a>","<a href=\"#SYNOPSIS\">SYNOPSIS</a>","<a href=\"#DESCRIPTION\">DESCRIPTION</a>","<a href=\"#RETURN VALUE\">RETURN VALUE</a>","<a href=\"#ERRORS\">ERRORS</a>","<a href=\"#FILES\">FILES</a>","<a href=\"#ATTRIBUTES\">ATTRIBUTES</a>","<a href=\"#CONFORMING TO\">CONFORMING TO</a>","<a href=\"#NOTES\">NOTES</a>","<a href=\"#EXAMPLES\">EXAMPLES</a>","<a href=\"#SEE ALSO\">SEE ALSO</a>","<a href=\"#COLOPHON\">COLOPHON</a>"],"level":3}