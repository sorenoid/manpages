{"name":"ioctl_ficlonerange","description":"ioctl_ficlonerange, ioctl_ficlone - share some the data of one file with another file","body":"\n\n<h1 align=\"center\">IOCTL_FICLONERANGE</h1>\n\n\n\n\n\n\n\n\n\n\n\n\n<hr>\n\n\n<h2>NAME\n<a name=\"NAME\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">ioctl_ficlonerange,\nioctl_ficlone - share some the data of one file with another\nfile</p>\n\n<h2>SYNOPSIS\n<a name=\"SYNOPSIS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>#include\n&lt;sys/ioctl.h&gt; <br>\n#include &lt;linux/fs.h&gt;</b></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>int\nioctl(int</b> <i>dest_fd</i><b>, FICLONERANGE, struct\nfile_clone_range *</b><i>arg</i><b>); <br>\nint ioctl(int</b> <i>dest_fd</i><b>, FICLONE, int</b>\n<i>src_fd</i><b>);</b></p>\n\n<h2>DESCRIPTION\n<a name=\"DESCRIPTION\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">If a filesystem\nsupports files sharing physical storage between multiple\nfiles (&quot;reflink&quot;), this <a href=\"https://man.page/2/ioctl\">ioctl(2)</a> operation\ncan be used to make some of the data in the <i>src_fd</i>\nfile appear in the <i>dest_fd</i> file by sharing the\nunderlying storage, which is faster than making a separate\nphysical copy of the data. Both files must reside within the\nsame filesystem. If a file write should occur to a shared\nregion, the filesystem must ensure that the changes remain\nprivate to the file being written. This behavior is commonly\nreferred to as &quot;copy on write&quot;.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">This ioctl\nreflinks up to <i>src_length</i> bytes from file descriptor\n<i>src_fd</i> at offset <i>src_offset</i> into the file\n<i>dest_fd</i> at offset <i>dest_offset</i>, provided that\nboth are files. If <i>src_length</i> is zero, the ioctl\nreflinks to the end of the source file. This information is\nconveyed in a structure of the following form:</p>\n\n<p style=\"margin-left:17%; margin-top: 1em\">struct\nfile_clone_range { <br>\n__s64 src_fd; <br>\n__u64 src_offset; <br>\n__u64 src_length; <br>\n__u64 dest_offset; <br>\n};</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Clones are\natomic with regards to concurrent writes, so no locks need\nto be taken to obtain a consistent cloned copy.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The\n<b>FICLONE</b> ioctl clones entire files.</p>\n\n<h2>RETURN VALUE\n<a name=\"RETURN VALUE\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">On error, -1 is\nreturned, and <i>errno</i> is set to indicate the error.</p>\n\n<h2>ERRORS\n<a name=\"ERRORS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Error codes can\nbe one of, but are not limited to, the following:</p>\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EBADF</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p><i>src_fd</i> is not open for reading; <i>dest_fd</i> is\nnot open for writing or is open for append-only writes; or\nthe filesystem which <i>src_fd</i> resides on does not\nsupport reflink.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EINVAL</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>The filesystem does not support reflinking the ranges of\nthe given files. This error can also appear if either file\ndescriptor represents a device, FIFO, or socket. Disk\nfilesystems generally require the offset and length\narguments to be aligned to the fundamental block size. XFS\nand Btrfs do not support overlapping reflink ranges in the\nsame file.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EISDIR</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>One of the files is a directory and the filesystem does\nnot support shared regions in directories.</p></td></tr>\n</table>\n\n<p style=\"margin-left:11%;\"><b>EOPNOTSUPP</b></p>\n\n<p style=\"margin-left:22%;\">This can appear if the\nfilesystem does not support reflinking either file\ndescriptor, or if either file descriptor refers to special\ninodes.</p>\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"7%\">\n\n\n<p><b>EPERM</b></p></td>\n<td width=\"4%\"></td>\n<td width=\"32%\">\n\n\n<p><i>dest_fd</i> is immutable.</p></td>\n<td width=\"46%\">\n</td></tr>\n</table>\n\n<p style=\"margin-left:11%;\"><b>ETXTBSY</b></p>\n\n<p style=\"margin-left:22%;\">One of the files is a swap\nfile. Swap files cannot share storage.</p>\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"7%\">\n\n\n<p><b>EXDEV</b></p></td>\n<td width=\"4%\"></td>\n<td width=\"78%\">\n\n\n<p><i>dest_fd</i> and <i>src_fd</i> are not on the same\nmounted filesystem.</p></td></tr>\n</table>\n\n<h2>VERSIONS\n<a name=\"VERSIONS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">These ioctl\noperations first appeared in Linux 4.5. They were previously\nknown as <b>BTRFS_IOC_CLONE</b> and\n<b>BTRFS_IOC_CLONE_RANGE</b>, and were private to Btrfs.</p>\n\n<h2>CONFORMING TO\n<a name=\"CONFORMING TO\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">This API is\nLinux-specific.</p>\n\n<h2>NOTES\n<a name=\"NOTES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Because a\ncopy-on-write operation requires the allocation of new\nstorage, the <a href=\"https://man.page/2/fallocate\">fallocate(2)</a> operation may unshare\nshared blocks to guarantee that subsequent writes will not\nfail because of lack of disk space.</p>\n\n<h2>SEE ALSO\n<a name=\"SEE ALSO\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><a href=\"https://man.page/2/ioctl\">ioctl(2)</a></p>\n\n<h2>COLOPHON\n<a name=\"COLOPHON\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">This page is\npart of release 5.10 of the Linux <i>man-pages</i> project.\nA description of the project, information about reporting\nbugs, and the latest version of this page, can be found at\nhttps://www.kernel.org/doc/man-pages/.</p>\n<hr>\n","headings":["<a href=\"#NAME\">NAME</a>","<a href=\"#SYNOPSIS\">SYNOPSIS</a>","<a href=\"#DESCRIPTION\">DESCRIPTION</a>","<a href=\"#RETURN VALUE\">RETURN VALUE</a>","<a href=\"#ERRORS\">ERRORS</a>","<a href=\"#VERSIONS\">VERSIONS</a>","<a href=\"#CONFORMING TO\">CONFORMING TO</a>","<a href=\"#NOTES\">NOTES</a>","<a href=\"#SEE ALSO\">SEE ALSO</a>","<a href=\"#COLOPHON\">COLOPHON</a>"],"level":2}