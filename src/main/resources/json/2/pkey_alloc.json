{"name":"pkey_alloc","body":"\n\n<h1 align=\"center\">PKEY_ALLOC</h1>\n\n\n\n\n\n\n\n\n\n\n\n\n\n<hr>\n\n\n<h2>NAME\n<a name=\"NAME\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">pkey_alloc,\npkey_free - allocate or free a protection key</p>\n\n<h2>SYNOPSIS\n<a name=\"SYNOPSIS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>#define\n_GNU_SOURCE</b> /* See feature_test_macros(7) */ <b><br>\n#include &lt;sys/mman.h&gt;</b></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>int\npkey_alloc(unsigned int</b> <i>flags</i><b>, unsigned\nint</b> <i>access_rights</i><b>); <br>\nint pkey_free(int</b> <i>pkey</i><b>);</b></p>\n\n<h2>DESCRIPTION\n<a name=\"DESCRIPTION\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>pkey_alloc</b>()\nallocates a protection key (pkey) and allows it to be passed\nto <a href=\"https://man.page/2/pkey_mprotect\">pkey_mprotect(2)</a>.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The\n<b>pkey_alloc</b>() <i>flags</i> is reserved for future use\nand currently must always be specified as 0.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The\n<b>pkey_alloc</b>() <i>access_rights</i> argument may\ncontain zero or more disable operations: <b><br>\nPKEY_DISABLE_ACCESS</b></p>\n\n<p style=\"margin-left:22%;\">Disable all data access to\nmemory covered by the returned protection key.</p>\n\n<p style=\"margin-left:11%;\"><b>PKEY_DISABLE_WRITE</b></p>\n\n<p style=\"margin-left:22%;\">Disable write access to memory\ncovered by the returned protection key.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>pkey_free</b>()\nfrees a protection key and makes it available for later\nallocations. After a protection key has been freed, it may\nno longer be used in any protection-key-related\noperations.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">An application\nshould not call <b>pkey_free</b>() on any protection key\nwhich has been assigned to an address range by\n<a href=\"https://man.page/2/pkey_mprotect\">pkey_mprotect(2)</a> and which is still in use. The\nbehavior in this case is undefined and may result in an\nerror.</p>\n\n<h2>RETURN VALUE\n<a name=\"RETURN VALUE\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">On success,\n<b>pkey_alloc</b>() returns a positive protection key value.\nOn success, <b>pkey_free</b>() returns zero. On error, -1 is\nreturned, and <i>errno</i> is set appropriately.</p>\n\n<h2>ERRORS\n<a name=\"ERRORS\"></a>\n</h2>\n\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p style=\"margin-top: 1em\"><b>EINVAL</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p style=\"margin-top: 1em\"><i>pkey</i>, <i>flags</i>, or\n<i>access_rights</i> is invalid.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>ENOSPC</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>(<b>pkey_alloc</b>()) All protection keys available for\nthe current process have been allocated. The number of keys\navailable is architecture-specific and\nimplementation-specific and may be reduced by\nkernel-internal use of certain keys. There are currently 15\nkeys available to user programs on x86.</p></td></tr>\n</table>\n\n<p style=\"margin-left:22%; margin-top: 1em\">This error will\nalso be returned if the processor or operating system does\nnot support protection keys. Applications should always be\nprepared to handle this error, since factors outside of the\napplication&rsquo;s control can reduce the number of\navailable pkeys.</p>\n\n<h2>VERSIONS\n<a name=\"VERSIONS\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>pkey_alloc</b>()\nand <b>pkey_free</b>() were added to Linux in kernel 4.9;\nlibrary support was added in glibc 2.27.</p>\n\n<h2>CONFORMING TO\n<a name=\"CONFORMING TO\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">The\n<b>pkey_alloc</b>() and <b>pkey_free</b>() system calls are\nLinux-specific.</p>\n\n<h2>NOTES\n<a name=\"NOTES\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>pkey_alloc</b>()\nis always safe to call regardless of whether or not the\noperating system supports protection keys. It can be used in\nlieu of any other mechanism for detecting pkey support and\nwill simply fail with the error <b>ENOSPC</b> if the\noperating system has no pkey support.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The kernel\nguarantees that the contents of the hardware rights register\n(PKRU) will be preserved only for allocated protection keys.\nAny time a key is unallocated (either before the first call\nreturning that key from <b>pkey_alloc</b>() or after it is\nfreed via <b>pkey_free</b>()), the kernel may make arbitrary\nchanges to the parts of the rights register affecting access\nto that key.</p>\n\n<h2>EXAMPLES\n<a name=\"EXAMPLES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">See\n<a href=\"https://man.page/7/pkeys\">pkeys(7)</a>.</p>\n\n<h2>SEE ALSO\n<a name=\"SEE ALSO\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><a href=\"https://man.page/2/pkey_mprotect\">pkey_mprotect(2)</a>,\n<a href=\"https://man.page/7/pkeys\">pkeys(7)</a></p>\n\n<h2>COLOPHON\n<a name=\"COLOPHON\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">This page is\npart of release 5.10 of the Linux <i>man-pages</i> project.\nA description of the project, information about reporting\nbugs, and the latest version of this page, can be found at\nhttps://www.kernel.org/doc/man-pages/.</p>\n<hr>\n","headings":["<a href=\"#NAME\">NAME</a>","<a href=\"#SYNOPSIS\">SYNOPSIS</a>","<a href=\"#DESCRIPTION\">DESCRIPTION</a>","<a href=\"#RETURN VALUE\">RETURN VALUE</a>","<a href=\"#ERRORS\">ERRORS</a>","<a href=\"#VERSIONS\">VERSIONS</a>","<a href=\"#CONFORMING TO\">CONFORMING TO</a>","<a href=\"#NOTES\">NOTES</a>","<a href=\"#EXAMPLES\">EXAMPLES</a>","<a href=\"#SEE ALSO\">SEE ALSO</a>","<a href=\"#COLOPHON\">COLOPHON</a>"],"level":2}