{"name":"move_pages","body":"\n\n<h1 align=\"center\">MOVE_PAGES</h1>\n\n\n\n\n\n\n\n\n\n\n\n\n<hr>\n\n\n<h2>NAME\n<a name=\"NAME\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">move_pages -\nmove individual pages of a process to another node</p>\n\n<h2>SYNOPSIS\n<a name=\"SYNOPSIS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>#include\n&lt;numaif.h&gt;</b></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>long\nmove_pages(int</b> <i>pid</i><b>, unsigned long count, void\n**</b><i>pages</i><b>, <br>\nconst int *</b><i>nodes</i><b>, int *</b><i>status</i><b>,\nint</b> <i>flags</i><b>);</b></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Link with\n<i>-lnuma</i>.</p>\n\n<h2>DESCRIPTION\n<a name=\"DESCRIPTION\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>move_pages</b>()\nmoves the specified <i>pages</i> of the process <i>pid</i>\nto the memory nodes specified by <i>nodes</i>. The result of\nthe move is reflected in <i>status</i>. The <i>flags</i>\nindicate constraints on the pages to be moved.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><i>pid</i> is\nthe ID of the process in which pages are to be moved. If\n<i>pid</i> is 0, then <b>move_pages</b>() moves pages of the\ncalling process.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">To move pages\nin another process requires the following privileges:</p>\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p>*</p></td>\n<td width=\"3%\"></td>\n<td width=\"85%\">\n\n\n<p>In kernels up to and including Linux 4.12: the caller\nmust be privileged (<b>CAP_SYS_NICE</b>) or the real or\neffective user ID of the calling process must match the real\nor saved-set user ID of the target process.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p>*</p></td>\n<td width=\"3%\"></td>\n<td width=\"85%\">\n\n\n<p>The older rules allowed the caller to discover various\nvirtual address choices made by the kernel that could lead\nto the defeat of address-space-layout randomization for a\nprocess owned by the same UID as the caller, the rules were\nchanged starting with Linux 4.13. Since Linux 4.13,\npermission is governed by a ptrace access mode\n<b>PTRACE_MODE_READ_REALCREDS</b> check with respect to the\ntarget process; see <a href=\"https://man.page/2/ptrace\">ptrace(2)</a>.</p></td></tr>\n</table>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><i>count</i> is\nthe number of pages to move. It defines the size of the\nthree arrays <i>pages</i>, <i>nodes</i>, and\n<i>status</i>.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><i>pages</i> is\nan array of pointers to the pages that should be moved.\nThese are pointers that should be aligned to page\nboundaries. Addresses are specified as seen by the process\nspecified by <i>pid</i>.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><i>nodes</i> is\nan array of integers that specify the desired location for\neach page. Each element in the array is a node number.\n<i>nodes</i> can also be NULL, in which case\n<b>move_pages</b>() does not move any pages but instead will\nreturn the node where each page currently resides, in the\n<i>status</i> array. Obtaining the status of each page may\nbe necessary to determine pages that need to be moved.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><i>status</i>\nis an array of integers that return the status of each page.\nThe array contains valid values only if <b>move_pages</b>()\ndid not return an error. Preinitialization of the array to a\nvalue which cannot represent a real numa node or valid error\nof status array could help to identify pages that have been\nmigrated.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><i>flags</i>\nspecify what types of pages to move. <b>MPOL_MF_MOVE</b>\nmeans that only pages that are in exclusive use by the\nprocess are to be moved. <b>MPOL_MF_MOVE_ALL</b> means that\npages shared between multiple processes can also be moved.\nThe process must be privileged (<b>CAP_SYS_NICE</b>) to use\n<b>MPOL_MF_MOVE_ALL</b>.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>Page states\nin the status array</b> <br>\nThe following values can be returned in each element of the\n<i>status</i> array. <b><br>\n0..MAX_NUMNODES</b></p>\n\n<p style=\"margin-left:22%;\">Identifies the node on which\nthe page resides.</p>\n\n<p style=\"margin-left:11%;\"><b>-EACCES</b></p>\n\n<p style=\"margin-left:22%;\">The page is mapped by multiple\nprocesses and can be moved only if <b>MPOL_MF_MOVE_ALL</b>\nis specified.</p>\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>-EBUSY</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>The page is currently busy and cannot be moved. Try\nagain later. This occurs if a page is undergoing I/O or\nanother kernel subsystem is holding a reference to the\npage.</p> </td></tr>\n</table>\n\n<p style=\"margin-left:11%;\"><b>-EFAULT</b></p>\n\n<p style=\"margin-left:22%;\">This is a zero page or the\nmemory area is not mapped by the process.</p>\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"6%\">\n\n\n<p><b>-EIO</b></p></td>\n<td width=\"5%\"></td>\n<td width=\"78%\">\n\n\n<p>Unable to write back a page. The page has to be written\nback in order to move it since the page is dirty and the\nfilesystem does not provide a migration function that would\nallow the move of dirty pages.</p></td></tr>\n</table>\n\n<p style=\"margin-left:11%;\"><b>-EINVAL</b></p>\n\n<p style=\"margin-left:22%;\">A dirty page cannot be moved.\nThe filesystem does not provide a migration function and has\nno ability to write back pages.</p>\n\n<p style=\"margin-left:11%;\"><b>-ENOENT</b></p>\n\n<p style=\"margin-left:22%;\">The page is not present.</p>\n\n<p style=\"margin-left:11%;\"><b>-ENOMEM</b></p>\n\n<p style=\"margin-left:22%;\">Unable to allocate memory on\ntarget node.</p>\n\n<h2>RETURN VALUE\n<a name=\"RETURN VALUE\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">On success\n<b>move_pages</b>() returns zero. On error, it returns -1,\nand sets <i>errno</i> to indicate the error. If positive\nvalue is returned, it is the number of nonmigrated\npages.</p>\n\n<h2>ERRORS\n<a name=\"ERRORS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>Positive\nvalue</b></p>\n\n<p style=\"margin-left:22%;\">The number of nonmigrated pages\nif they were the result of nonfatal reasons (since Linux\n4.17). <b>E2BIG</b> Too many pages to move. Since Linux\n2.6.29, the kernel no longer generates this error.</p>\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EACCES</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>One of the target nodes is not allowed by the current\ncpuset.</p> </td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EFAULT</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>Parameter array could not be accessed.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EINVAL</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>Flags other than <b>MPOL_MF_MOVE</b> and\n<b>MPOL_MF_MOVE_ALL</b> was specified or an attempt was made\nto migrate pages of a kernel thread.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>ENODEV</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>One of the target nodes is not online.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EPERM</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>The caller specified <b>MPOL_MF_MOVE_ALL</b> without\nsufficient privileges (<b>CAP_SYS_NICE</b>). Or, the caller\nattempted to move pages of a process belonging to another\nuser but did not have privilege to do so\n(<b>CAP_SYS_NICE</b>).</p> </td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>ESRCH</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>Process does not exist.</p></td></tr>\n</table>\n\n<h2>VERSIONS\n<a name=\"VERSIONS\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>move_pages</b>()\nfirst appeared on Linux in version 2.6.18.</p>\n\n<h2>CONFORMING TO\n<a name=\"CONFORMING TO\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">This system\ncall is Linux-specific.</p>\n\n<h2>NOTES\n<a name=\"NOTES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">For information\non library support, see <a href=\"https://man.page/7/numa\">numa(7)</a>.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Use\n<a href=\"https://man.page/2/get_mempolicy\">get_mempolicy(2)</a> with the <b>MPOL_F_MEMS_ALLOWED</b>\nflag to obtain the set of nodes that are allowed by the\ncurrent cpuset. Note that this information is subject to\nchange at any time by manual or automatic reconfiguration of\nthe cpuset.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Use of this\nfunction may result in pages whose location (node) violates\nthe memory policy established for the specified addresses\n(See <a href=\"https://man.page/2/mbind\">mbind(2)</a>) and/or the specified process (See\n<a href=\"https://man.page/2/set_mempolicy\">set_mempolicy(2)</a>). That is, memory policy does not\nconstrain the destination nodes used by\n<b>move_pages</b>().</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The\n<i>&lt;numaif.h&gt;</i> header is not included with glibc,\nbut requires installing <i>libnuma-devel</i> or a similar\npackage.</p>\n\n<h2>SEE ALSO\n<a name=\"SEE ALSO\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><a href=\"https://man.page/2/get_mempolicy\">get_mempolicy(2)</a>,\n<a href=\"https://man.page/2/mbind\">mbind(2)</a>, <a href=\"https://man.page/2/set_mempolicy\">set_mempolicy(2)</a>, <a href=\"https://man.page/3/numa\">numa(3)</a>,\n<a href=\"https://man.page/5/numa_maps\">numa_maps(5)</a>, <a href=\"https://man.page/7/cpuset\">cpuset(7)</a>, <a href=\"https://man.page/7/numa\">numa(7)</a>,\n<b>migratepages</b>(8), <b>numastat</b>(8)</p>\n\n<h2>COLOPHON\n<a name=\"COLOPHON\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">This page is\npart of release 5.10 of the Linux <i>man-pages</i> project.\nA description of the project, information about reporting\nbugs, and the latest version of this page, can be found at\nhttps://www.kernel.org/doc/man-pages/.</p>\n<hr>\n","headings":["<a href=\"#NAME\">NAME</a>","<a href=\"#SYNOPSIS\">SYNOPSIS</a>","<a href=\"#DESCRIPTION\">DESCRIPTION</a>","<a href=\"#RETURN VALUE\">RETURN VALUE</a>","<a href=\"#ERRORS\">ERRORS</a>","<a href=\"#VERSIONS\">VERSIONS</a>","<a href=\"#CONFORMING TO\">CONFORMING TO</a>","<a href=\"#NOTES\">NOTES</a>","<a href=\"#SEE ALSO\">SEE ALSO</a>","<a href=\"#COLOPHON\">COLOPHON</a>"],"level":2}