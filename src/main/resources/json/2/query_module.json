{"name":"query_module","description":"query_module -\nquery the kernel for various bits pertaining to modules","body":"\n\n<h1 align=\"center\">QUERY_MODULE</h1>\n\n\n\n\n\n\n\n\n\n\n\n\n<hr>\n\n\n<h2>NAME\n<a name=\"NAME\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">query_module -\nquery the kernel for various bits pertaining to modules</p>\n\n<h2>SYNOPSIS\n<a name=\"SYNOPSIS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>#include\n&lt;linux/module.h&gt;</b></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>int\nquery_module(const char *</b><i>name</i><b>, int</b>\n<i>which</i><b>, void *</b><i>buf</i><b>, <br>\nsize_t</b> <i>bufsize</i><b>, size_t\n*</b><i>ret</i><b>);</b></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><i>Note</i>: No\ndeclaration of this system call is provided in glibc\nheaders; see NOTES.</p>\n\n<h2>DESCRIPTION\n<a name=\"DESCRIPTION\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><i>Note</i>:\nThis system call is present only in kernels before Linux\n2.6.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>query_module</b>()\nrequests information from the kernel about loadable modules.\nThe returned information is placed in the buffer pointed to\nby <i>buf</i>. The caller must specify the size of\n<i>buf</i> in <i>bufsize</i>. The precise nature and format\nof the returned information depend on the operation\nspecified by <i>which</i>. Some operations require\n<i>name</i> to identify a currently loaded module, some\nallow <i>name</i> to be NULL, indicating the kernel\nproper.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The following\nvalues can be specified for <i>which</i>:</p>\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p><b>0</b></p></td>\n<td width=\"10%\"></td>\n<td width=\"78%\">\n\n\n<p>Returns success, if the kernel supports\n<b>query_module</b>(). Used to probe for availability of the\nsystem call.</p></td></tr>\n</table>\n\n<p style=\"margin-left:11%;\"><b>QM_MODULES</b></p>\n\n<p style=\"margin-left:22%;\">Returns the names of all loaded\nmodules. The returned buffer consists of a sequence of\nnull-terminated strings; <i>ret</i> is set to the number of\nmodules.</p>\n\n<p style=\"margin-left:11%;\"><b>QM_DEPS</b></p>\n\n<p style=\"margin-left:22%;\">Returns the names of all\nmodules used by the indicated module. The returned buffer\nconsists of a sequence of null-terminated strings;\n<i>ret</i> is set to the number of modules.</p>\n\n<p style=\"margin-left:11%;\"><b>QM_REFS</b></p>\n\n<p style=\"margin-left:22%;\">Returns the names of all\nmodules using the indicated module. This is the inverse of\n<b>QM_DEPS</b>. The returned buffer consists of a sequence\nof null-terminated strings; <i>ret</i> is set to the number\nof modules.</p>\n\n<p style=\"margin-left:11%;\"><b>QM_SYMBOLS</b></p>\n\n<p style=\"margin-left:22%;\">Returns the symbols and values\nexported by the kernel or the indicated module. The returned\nbuffer is an array of structures of the following form</p>\n\n<p style=\"margin-left:28%; margin-top: 1em\">struct\nmodule_symbol { <br>\nunsigned long value; <br>\nunsigned long name; <br>\n};</p>\n\n<p style=\"margin-left:22%; margin-top: 1em\">followed by\nnull-terminated strings. The value of <i>name</i> is the\ncharacter offset of the string relative to the start of\n<i>buf</i>; <i>ret</i> is set to the number of symbols.</p>\n\n<p style=\"margin-left:11%;\"><b>QM_INFO</b></p>\n\n<p style=\"margin-left:22%;\">Returns miscellaneous\ninformation about the indicated module. The output buffer\nformat is:</p>\n\n<p style=\"margin-left:28%; margin-top: 1em\">struct\nmodule_info { <br>\nunsigned long address; <br>\nunsigned long size; <br>\nunsigned long flags; <br>\n};</p>\n\n<p style=\"margin-left:22%; margin-top: 1em\">where\n<i>address</i> is the kernel address at which the module\nresides, <i>size</i> is the size of the module in bytes, and\n<i>flags</i> is a mask of <b>MOD_RUNNING</b>,\n<b>MOD_AUTOCLEAN</b>, and so on, that indicates the current\nstatus of the module (see the Linux kernel source file\n<i>include/linux/module.h</i>). <i>ret</i> is set to the\nsize of the <i>module_info</i> structure.</p>\n\n<h2>RETURN VALUE\n<a name=\"RETURN VALUE\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">On success,\nzero is returned. On error, -1 is returned and <i>errno</i>\nis set appropriately.</p>\n\n<h2>ERRORS\n<a name=\"ERRORS\"></a>\n</h2>\n\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p style=\"margin-top: 1em\"><b>EFAULT</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p style=\"margin-top: 1em\">At least one of <i>name</i>,\n<i>buf</i>, or <i>ret</i> was outside the program&rsquo;s\naccessible address space.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EINVAL</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>Invalid <i>which</i>; or <i>name</i> is NULL (indicating\n&quot;the kernel&quot;), but this is not permitted with the\nspecified value of <i>which</i>.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>ENOENT</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>No module by that <i>name</i> exists.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>ENOSPC</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>The buffer size provided was too small. <i>ret</i> is\nset to the minimum size needed.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>ENOSYS</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p><b>query_module</b>() is not supported in this version\nof the kernel (e.g., the kernel is version 2.6 or\nlater).</p> </td></tr>\n</table>\n\n<h2>VERSIONS\n<a name=\"VERSIONS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">This system\ncall is present on Linux only up until kernel 2.4; it was\nremoved in Linux 2.6.</p>\n\n<h2>CONFORMING TO\n<a name=\"CONFORMING TO\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>query_module</b>()\nis Linux-specific.</p>\n\n<h2>NOTES\n<a name=\"NOTES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Some of the\ninformation that was formerly available via\n<b>query_module</b>() can be obtained from\n<i>/proc/modules</i>, <i>/proc/kallsyms</i>, and the files\nunder the directory <i>/sys/module</i>.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The\n<b>query_module</b>() system call is not supported by glibc.\nNo declaration is provided in glibc headers, but, through a\nquirk of history, glibc does export an ABI for this system\ncall. Therefore, in order to employ this system call, it is\nsufficient to manually declare the interface in your code;\nalternatively, you can invoke the system call using\n<a href=\"https://man.page/2/syscall\">syscall(2)</a>.</p>\n\n<h2>SEE ALSO\n<a name=\"SEE ALSO\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><a href=\"https://man.page/2/create_module\">create_module(2)</a>,\n<a href=\"https://man.page/2/delete_module\">delete_module(2)</a>, <a href=\"https://man.page/2/get_kernel_syms\">get_kernel_syms(2)</a>,\n<a href=\"https://man.page/2/init_module\">init_module(2)</a>, <b>lsmod</b>(8),\n<b>modinfo</b>(8)</p>\n\n<h2>COLOPHON\n<a name=\"COLOPHON\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">This page is\npart of release 5.10 of the Linux <i>man-pages</i> project.\nA description of the project, information about reporting\nbugs, and the latest version of this page, can be found at\nhttps://www.kernel.org/doc/man-pages/.</p>\n<hr>\n","headings":["<a href=\"#NAME\">NAME</a>","<a href=\"#SYNOPSIS\">SYNOPSIS</a>","<a href=\"#DESCRIPTION\">DESCRIPTION</a>","<a href=\"#RETURN VALUE\">RETURN VALUE</a>","<a href=\"#ERRORS\">ERRORS</a>","<a href=\"#VERSIONS\">VERSIONS</a>","<a href=\"#CONFORMING TO\">CONFORMING TO</a>","<a href=\"#NOTES\">NOTES</a>","<a href=\"#SEE ALSO\">SEE ALSO</a>","<a href=\"#COLOPHON\">COLOPHON</a>"],"level":2}