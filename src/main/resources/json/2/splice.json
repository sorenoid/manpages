{"name":"splice","description":"splice - splice\ndata to/from a pipe","body":"\n\n<h1 align=\"center\">SPLICE</h1>\n\n\n\n\n\n\n\n\n\n\n\n\n\n<hr>\n\n\n<h2>NAME\n<a name=\"NAME\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">splice - splice\ndata to/from a pipe</p>\n\n<h2>SYNOPSIS\n<a name=\"SYNOPSIS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>#define\n_GNU_SOURCE</b> /* See feature_test_macros(7) */ <b><br>\n#include &lt;fcntl.h&gt;</b></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>ssize_t\nsplice(int</b> <i>fd_in</i><b>, loff_t\n*</b><i>off_in</i><b>, int</b> <i>fd_out</i><b>, <br>\nloff_t *</b><i>off_out</i><b>, size_t</b> <i>len</i><b>,\nunsigned int</b> <i>flags</i><b>);</b></p>\n\n<h2>DESCRIPTION\n<a name=\"DESCRIPTION\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>splice</b>()\nmoves data between two file descriptors without copying\nbetween kernel address space and user address space. It\ntransfers up to <i>len</i> bytes of data from the file\ndescriptor <i>fd_in</i> to the file descriptor\n<i>fd_out</i>, where one of the file descriptors must refer\nto a pipe.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The following\nsemantics apply for <i>fd_in</i> and <i>off_in</i>:</p>\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p>*</p></td>\n<td width=\"3%\"></td>\n<td width=\"85%\">\n\n\n<p>If <i>fd_in</i> refers to a pipe, then <i>off_in</i>\nmust be NULL.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p>*</p></td>\n<td width=\"3%\"></td>\n<td width=\"85%\">\n\n\n<p>If <i>fd_in</i> does not refer to a pipe and\n<i>off_in</i> is NULL, then bytes are read from <i>fd_in</i>\nstarting from the file offset, and the file offset is\nadjusted appropriately.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p>*</p></td>\n<td width=\"3%\"></td>\n<td width=\"85%\">\n\n\n<p>If <i>fd_in</i> does not refer to a pipe and\n<i>off_in</i> is not NULL, then <i>off_in</i> must point to\na buffer which specifies the starting offset from which\nbytes will be read from <i>fd_in</i>; in this case, the file\noffset of <i>fd_in</i> is not changed.</p></td></tr>\n</table>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Analogous\nstatements apply for <i>fd_out</i> and <i>off_out</i>.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The\n<i>flags</i> argument is a bit mask that is composed by\nORing together zero or more of the following values: <b><br>\nSPLICE_F_MOVE</b></p>\n\n<p style=\"margin-left:22%;\">Attempt to move pages instead\nof copying. This is only a hint to the kernel: pages may\nstill be copied if the kernel cannot move the pages from the\npipe, or if the pipe buffers don&rsquo;t refer to full\npages. The initial implementation of this flag was buggy:\ntherefore starting in Linux 2.6.21 it is a no-op (but is\nstill permitted in a <b>splice</b>() call); in the future, a\ncorrect implementation may be restored.</p>\n\n<p style=\"margin-left:11%;\"><b>SPLICE_F_NONBLOCK</b></p>\n\n<p style=\"margin-left:22%;\">Do not block on I/O. This makes\nthe splice pipe operations nonblocking, but <b>splice</b>()\nmay nevertheless block because the file descriptors that are\nspliced to/from may block (unless they have the\n<b>O_NONBLOCK</b> flag set).</p>\n\n<p style=\"margin-left:11%;\"><b>SPLICE_F_MORE</b></p>\n\n<p style=\"margin-left:22%;\">More data will be coming in a\nsubsequent splice. This is a helpful hint when the\n<i>fd_out</i> refers to a socket (see also the description\nof <b>MSG_MORE</b> in <a href=\"https://man.page/2/send\">send(2)</a>, and the description of\n<b>TCP_CORK</b> in <a href=\"https://man.page/7/tcp\">tcp(7)</a>).</p>\n\n<p style=\"margin-left:11%;\"><b>SPLICE_F_GIFT</b></p>\n\n<p style=\"margin-left:22%;\">Unused for <b>splice</b>(); see\n<a href=\"https://man.page/2/vmsplice\">vmsplice(2)</a>.</p>\n\n<h2>RETURN VALUE\n<a name=\"RETURN VALUE\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Upon successful\ncompletion, <b>splice</b>() returns the number of bytes\nspliced to or from the pipe.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">A return value\nof 0 means end of input. If <i>fd_in</i> refers to a pipe,\nthen this means that there was no data to transfer, and it\nwould not make sense to block because there are no writers\nconnected to the write end of the pipe.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">On error,\n<b>splice</b>() returns -1 and <i>errno</i> is set to\nindicate the error.</p>\n\n<h2>ERRORS\n<a name=\"ERRORS\"></a>\n</h2>\n\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p style=\"margin-top: 1em\"><b>EAGAIN</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p style=\"margin-top: 1em\"><b>SPLICE_F_NONBLOCK</b> was\nspecified in <i>flags</i> or one of the file descriptors had\nbeen marked as nonblocking (<b>O_NONBLOCK</b>)<b>,</b> and\nthe operation would block.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EBADF</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>One or both file descriptors are not valid, or do not\nhave proper read-write mode.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EINVAL</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>The target filesystem doesn&rsquo;t support\nsplicing.</p> </td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EINVAL</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>The target file is opened in append mode.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EINVAL</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>Neither of the file descriptors refers to a pipe.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EINVAL</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>An offset was given for nonseekable device (e.g., a\npipe).</p> </td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EINVAL</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p><i>fd_in</i> and <i>fd_out</i> refer to the same\npipe.</p> </td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>ENOMEM</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>Out of memory.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>ESPIPE</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>Either <i>off_in</i> or <i>off_out</i> was not NULL, but\nthe corresponding file descriptor refers to a pipe.</p></td></tr>\n</table>\n\n<h2>VERSIONS\n<a name=\"VERSIONS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">The\n<b>splice</b>() system call first appeared in Linux 2.6.17;\nlibrary support was added to glibc in version 2.5.</p>\n\n<h2>CONFORMING TO\n<a name=\"CONFORMING TO\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">This system\ncall is Linux-specific.</p>\n\n<h2>NOTES\n<a name=\"NOTES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">The three\nsystem calls <b>splice</b>(), <a href=\"https://man.page/2/vmsplice\">vmsplice(2)</a>, and\n<a href=\"https://man.page/2/tee\">tee(2)</a>, provide user-space programs with full control\nover an arbitrary kernel buffer, implemented within the\nkernel using the same type of buffer that is used for a\npipe. In overview, these system calls perform the following\ntasks:</p>\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p style=\"margin-top: 1em\">&bull;</p></td>\n<td width=\"2%\"></td>\n<td width=\"86%\">\n\n\n<p style=\"margin-top: 1em\"><b>splice</b>() moves data from\nthe buffer to an arbitrary file descriptor, or vice versa,\nor from one buffer to another.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p>&bull;</p></td>\n<td width=\"2%\"></td>\n<td width=\"86%\">\n\n\n<p><a href=\"https://man.page/2/tee\">tee(2)</a> &quot;copies&quot; the data from one\nbuffer to another.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"1%\">\n\n\n<p>&bull;</p></td>\n<td width=\"2%\"></td>\n<td width=\"86%\">\n\n\n<p><a href=\"https://man.page/2/vmsplice\">vmsplice(2)</a> &quot;copies&quot; data from user\nspace into the buffer.</p></td></tr>\n</table>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Though we talk\nof copying, actual copies are generally avoided. The kernel\ndoes this by implementing a pipe buffer as a set of\nreference-counted pointers to pages of kernel memory. The\nkernel creates &quot;copies&quot; of pages in a buffer by\ncreating new pointers (for the output buffer) referring to\nthe pages, and increasing the reference counts for the\npages: only pointers are copied, not the pages of the\nbuffer.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">In Linux 2.6.30\nand earlier, exactly one of <i>fd_in</i> and <i>fd_out</i>\nwas required to be a pipe. Since Linux 2.6.31, both\narguments may refer to pipes.</p>\n\n<h2>EXAMPLES\n<a name=\"EXAMPLES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">See\n<a href=\"https://man.page/2/tee\">tee(2)</a>.</p>\n\n<h2>SEE ALSO\n<a name=\"SEE ALSO\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><a href=\"https://man.page/2/copy_file_range\">copy_file_range(2)</a>,\n<a href=\"https://man.page/2/sendfile\">sendfile(2)</a>, <a href=\"https://man.page/2/tee\">tee(2)</a>, <a href=\"https://man.page/2/vmsplice\">vmsplice(2)</a>,\n<a href=\"https://man.page/7/pipe\">pipe(7)</a></p>\n\n<h2>COLOPHON\n<a name=\"COLOPHON\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">This page is\npart of release 5.10 of the Linux <i>man-pages</i> project.\nA description of the project, information about reporting\nbugs, and the latest version of this page, can be found at\nhttps://www.kernel.org/doc/man-pages/.</p>\n<hr>\n","headings":["<a href=\"#NAME\">NAME</a>","<a href=\"#SYNOPSIS\">SYNOPSIS</a>","<a href=\"#DESCRIPTION\">DESCRIPTION</a>","<a href=\"#RETURN VALUE\">RETURN VALUE</a>","<a href=\"#ERRORS\">ERRORS</a>","<a href=\"#VERSIONS\">VERSIONS</a>","<a href=\"#CONFORMING TO\">CONFORMING TO</a>","<a href=\"#NOTES\">NOTES</a>","<a href=\"#EXAMPLES\">EXAMPLES</a>","<a href=\"#SEE ALSO\">SEE ALSO</a>","<a href=\"#COLOPHON\">COLOPHON</a>"],"level":2}