{"name":"subpage_prot","description":"subpage_prot -\ndefine a subpage protection for an address range","body":"\n\n<h1 align=\"center\">SUBPAGE_PROT</h1>\n\n\n\n\n\n\n\n\n\n\n\n\n<hr>\n\n\n<h2>NAME\n<a name=\"NAME\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">subpage_prot -\ndefine a subpage protection for an address range</p>\n\n<h2>SYNOPSIS\n<a name=\"SYNOPSIS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>int\nsubpage_prot(unsigned long</b> <i>addr</i><b>, unsigned\nlong</b> <i>len</i><b>, <br>\nuint32_t *</b><i>map</i><b>);</b></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><i>Note</i>:\nThere is no glibc wrapper for this system call; see\nNOTES.</p>\n\n<h2>DESCRIPTION\n<a name=\"DESCRIPTION\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">The\nPowerPC-specific <b>subpage_prot</b>() system call provides\nthe facility to control the access permissions on individual\n4&nbsp;kB subpages on systems configured with a page size of\n64&nbsp;kB.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The protection\nmap is applied to the memory pages in the region starting at\n<i>addr</i> and continuing for <i>len</i> bytes. Both of\nthese arguments must be aligned to a 64-kB boundary.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The protection\nmap is specified in the buffer pointed to by <i>map</i>. The\nmap has 2 bits per 4&nbsp;kB subpage; thus each 32-bit word\nspecifies the protections of 16 4&nbsp;kB subpages inside a\n64&nbsp;kB page (so, the number of 32-bit words pointed to\nby <i>map</i> should equate to the number of 64-kB pages\nspecified by <i>len</i>). Each 2-bit field in the protection\nmap is either 0 to allow any access, 1 to prevent writes, or\n2 or 3 to prevent all accesses.</p>\n\n<h2>RETURN VALUE\n<a name=\"RETURN VALUE\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">On success,\n<b>subpage_prot</b>() returns 0. Otherwise, one of the error\ncodes specified below is returned.</p>\n\n<h2>ERRORS\n<a name=\"ERRORS\"></a>\n</h2>\n\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p style=\"margin-top: 1em\"><b>EFAULT</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p style=\"margin-top: 1em\">The buffer referred to by\n<i>map</i> is not accessible.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EINVAL</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>The <i>addr</i> or <i>len</i> arguments are incorrect.\nBoth of these arguments must be aligned to a multiple of the\nsystem page size, and they must not refer to a region\noutside of the address space of the process or to a region\nthat consists of huge pages.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>ENOMEM</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>Out of memory.</p></td></tr>\n</table>\n\n<h2>VERSIONS\n<a name=\"VERSIONS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">This system\ncall is provided on the PowerPC architecture since Linux\n2.6.25. The system call is provided only if the kernel is\nconfigured with <b>CONFIG_PPC_64K_PAGES</b>. No library\nsupport is provided.</p>\n\n<h2>CONFORMING TO\n<a name=\"CONFORMING TO\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">This system\ncall is Linux-specific.</p>\n\n<h2>NOTES\n<a name=\"NOTES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Glibc does not\nprovide a wrapper for this system call; call it using\n<a href=\"https://man.page/2/syscall\">syscall(2)</a>.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Normal page\nprotections (at the 64-kB page level) also apply; the\nsubpage protection mechanism is an additional constraint, so\nputting 0 in a 2-bit field won&rsquo;t allow writes to a\npage that is otherwise write-protected.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>Rationale</b>\n<br>\nThis system call is provided to assist writing emulators\nthat operate using 64-kB pages on PowerPC systems. When\nemulating systems such as x86, which uses a smaller page\nsize, the emulator can no longer use the memory-management\nunit (MMU) and normal system calls for controlling page\nprotections. (The emulator could emulate the MMU by checking\nand possibly remapping the address for each memory access in\nsoftware, but that is slow.) The idea is that the emulator\nsupplies an array of protection masks to apply to a\nspecified range of virtual addresses. These masks are\napplied at the level where hardware page-table entries\n(PTEs) are inserted into the hardware page table based on\nthe Linux PTEs, so the Linux PTEs are not affected. Implicit\nin this is that the regions of the address space that are\nprotected are switched to use 4-kB hardware pages rather\nthan 64-kB hardware pages (on machines with hardware 64-kB\npage support).</p>\n\n<h2>SEE ALSO\n<a name=\"SEE ALSO\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><a href=\"https://man.page/2/mprotect\">mprotect(2)</a>,\n<a href=\"https://man.page/2/syscall\">syscall(2)</a></p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><i>Documentation/admin-guide/mm/hugetlbpage.rst</i>\nin the Linux kernel source tree</p>\n\n<h2>COLOPHON\n<a name=\"COLOPHON\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">This page is\npart of release 5.10 of the Linux <i>man-pages</i> project.\nA description of the project, information about reporting\nbugs, and the latest version of this page, can be found at\nhttps://www.kernel.org/doc/man-pages/.</p>\n<hr>\n","headings":["<a href=\"#NAME\">NAME</a>","<a href=\"#SYNOPSIS\">SYNOPSIS</a>","<a href=\"#DESCRIPTION\">DESCRIPTION</a>","<a href=\"#RETURN VALUE\">RETURN VALUE</a>","<a href=\"#ERRORS\">ERRORS</a>","<a href=\"#VERSIONS\">VERSIONS</a>","<a href=\"#CONFORMING TO\">CONFORMING TO</a>","<a href=\"#NOTES\">NOTES</a>","<a href=\"#SEE ALSO\">SEE ALSO</a>","<a href=\"#COLOPHON\">COLOPHON</a>"],"level":2}