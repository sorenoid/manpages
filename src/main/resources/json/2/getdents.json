{"name":"getdents","description":"getdents,\ngetdents64 - get directory entries","body":"\n\n<h1 align=\"center\">GETDENTS</h1>\n\n\n\n\n\n\n\n\n\n\n\n\n<hr>\n\n\n<h2>NAME\n<a name=\"NAME\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">getdents,\ngetdents64 - get directory entries</p>\n\n<h2>SYNOPSIS\n<a name=\"SYNOPSIS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>long\ngetdents(unsigned int</b> <i>fd</i><b>, struct linux_dirent\n*</b><i>dirp</i><b>, <br>\nunsigned int</b> <i>count</i><b>);</b></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>#define\n_GNU_SOURCE</b> /* See feature_test_macros(7) */ <b><br>\n#include &lt;dirent.h&gt;</b></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>ssize_t\ngetdents64(int</b> <i>fd</i><b>, void *</b><i>dirp</i><b>,\nsize_t</b> <i>count</i><b>);</b></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><i>Note</i>:\nThere is no glibc wrapper for <b>getdents</b>(); see\nNOTES.</p>\n\n<h2>DESCRIPTION\n<a name=\"DESCRIPTION\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">These are not\nthe interfaces you are interested in. Look at\n<a href=\"https://man.page/3/readdir\">readdir(3)</a> for the POSIX-conforming C library\ninterface. This page documents the bare kernel system call\ninterfaces.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>getdents()</b>\n<br>\nThe system call <b>getdents</b>() reads several\n<i>linux_dirent</i> structures from the directory referred\nto by the open file descriptor <i>fd</i> into the buffer\npointed to by <i>dirp</i>. The argument <i>count</i>\nspecifies the size of that buffer.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The\n<i>linux_dirent</i> structure is declared as follows:</p>\n\n<p style=\"margin-left:17%; margin-top: 1em\">struct\nlinux_dirent { <br>\nunsigned long d_ino; /* Inode number */ <br>\nunsigned long d_off; /* Offset to next <i>linux_dirent</i>\n*/ <br>\nunsigned short d_reclen; /* Length of this\n<i>linux_dirent</i> */ <br>\nchar d_name[]; /* Filename (null-terminated) */ <br>\n/* length is actually (d_reclen - 2 - <br>\noffsetof(struct linux_dirent, d_name)) */ <br>\n/* <br>\nchar pad; // Zero padding byte <br>\nchar d_type; // File type (only since Linux <br>\n// 2.6.4); offset is (d_reclen - 1) <br>\n*/ <br>\n}</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><i>d_ino</i> is\nan inode number. <i>d_off</i> is the distance from the start\nof the directory to the start of the next\n<i>linux_dirent</i>. <i>d_reclen</i> is the size of this\nentire <i>linux_dirent</i>. <i>d_name</i> is a\nnull-terminated filename.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><i>d_type</i>\nis a byte at the end of the structure that indicates the\nfile type. It contains one of the following values (defined\nin <i>&lt;dirent.h&gt;</i>):</p>\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"15%\">\n\n\n<p><b>DT_BLK</b></p></td>\n<td width=\"3%\"></td>\n<td width=\"45%\">\n\n\n<p>This is a block device.</p></td>\n<td width=\"26%\">\n</td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"15%\">\n\n\n<p><b>DT_CHR</b></p></td>\n<td width=\"3%\"></td>\n<td width=\"45%\">\n\n\n<p>This is a character device.</p></td>\n<td width=\"26%\">\n</td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"15%\">\n\n\n<p><b>DT_DIR</b></p></td>\n<td width=\"3%\"></td>\n<td width=\"45%\">\n\n\n<p>This is a directory.</p></td>\n<td width=\"26%\">\n</td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"15%\">\n\n\n<p><b>DT_FIFO</b></p></td>\n<td width=\"3%\"></td>\n<td width=\"45%\">\n\n\n<p>This is a named pipe (FIFO).</p></td>\n<td width=\"26%\">\n</td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"15%\">\n\n\n<p><b>DT_LNK</b></p></td>\n<td width=\"3%\"></td>\n<td width=\"45%\">\n\n\n<p>This is a symbolic link.</p></td>\n<td width=\"26%\">\n</td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"15%\">\n\n\n<p><b>DT_REG</b></p></td>\n<td width=\"3%\"></td>\n<td width=\"45%\">\n\n\n<p>This is a regular file.</p></td>\n<td width=\"26%\">\n</td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"15%\">\n\n\n<p><b>DT_SOCK</b></p></td>\n<td width=\"3%\"></td>\n<td width=\"45%\">\n\n\n<p>This is a UNIX domain socket.</p></td>\n<td width=\"26%\">\n</td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"15%\">\n\n\n<p><b>DT_UNKNOWN</b></p></td>\n<td width=\"3%\"></td>\n<td width=\"45%\">\n\n\n<p>The file type is unknown.</p></td>\n<td width=\"26%\">\n</td></tr>\n</table>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The\n<i>d_type</i> field is implemented since Linux 2.6.4. It\noccupies a space that was previously a zero-filled padding\nbyte in the <i>linux_dirent</i> structure. Thus, on kernels\nup to and including 2.6.3, attempting to access this field\nalways provides the value 0 (<b>DT_UNKNOWN</b>).</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Currently, only\nsome filesystems (among them: Btrfs, ext2, ext3, and ext4)\nhave full support for returning the file type in\n<i>d_type</i>. All applications must properly handle a\nreturn of <b>DT_UNKNOWN</b>.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>getdents64()</b>\n<br>\nThe original Linux <b>getdents</b>() system call did not\nhandle large filesystems and large file offsets.\nConsequently, Linux 2.4 added <b>getdents64</b>(), with\nwider types for the <i>d_ino</i> and <i>d_off</i> fields. In\naddition, <b>getdents64</b>() supports an explicit\n<i>d_type</i> field.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The\n<b>getdents64</b>() system call is like <b>getdents</b>(),\nexcept that its second argument is a pointer to a buffer\ncontaining structures of the following type:</p>\n\n<p style=\"margin-left:17%; margin-top: 1em\">struct\nlinux_dirent64 { <br>\nino64_t d_ino; /* 64-bit inode number */ <br>\noff64_t d_off; /* 64-bit offset to next structure */ <br>\nunsigned short d_reclen; /* Size of this dirent */ <br>\nunsigned char d_type; /* File type */ <br>\nchar d_name[]; /* Filename (null-terminated) */ <br>\n};</p>\n\n<h2>RETURN VALUE\n<a name=\"RETURN VALUE\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">On success, the\nnumber of bytes read is returned. On end of directory, 0 is\nreturned. On error, -1 is returned, and <i>errno</i> is set\nappropriately.</p>\n\n<h2>ERRORS\n<a name=\"ERRORS\"></a>\n</h2>\n\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p style=\"margin-top: 1em\"><b>EBADF</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p style=\"margin-top: 1em\">Invalid file descriptor\n<i>fd</i>.</p> </td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EFAULT</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>Argument points outside the calling process&rsquo;s\naddress space.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EINVAL</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>Result buffer is too small.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>ENOENT</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>No such directory.</p></td></tr>\n</table>\n\n<p style=\"margin-left:11%;\"><b>ENOTDIR</b></p>\n\n<p style=\"margin-left:22%;\">File descriptor does not refer\nto a directory.</p>\n\n<h2>CONFORMING TO\n<a name=\"CONFORMING TO\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">SVr4.</p>\n\n<h2>NOTES\n<a name=\"NOTES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Library support\nfor <b>getdents64</b>() was added in glibc 2.30; there is no\nglibc wrapper for <b>getdents</b>(). Calling\n<b>getdents</b>() (or <b>getdents64</b>() on earlier glibc\nversions) requires the use of <a href=\"https://man.page/2/syscall\">syscall(2)</a>. In that\ncase you will need to define the <i>linux_dirent</i> or\n<i>linux_dirent64</i> structure yourself.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Probably, you\nwant to use <a href=\"https://man.page/3/readdir\">readdir(3)</a> instead of these system\ncalls.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">These calls\nsupersede <a href=\"https://man.page/2/readdir\">readdir(2)</a>.</p>\n\n<h2>EXAMPLES\n<a name=\"EXAMPLES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">The program\nbelow demonstrates the use of <b>getdents</b>(). The\nfollowing output shows an example of what we see when\nrunning this program on an ext2 directory:</p>\n\n<p style=\"margin-left:17%; margin-top: 1em\">$ <b>./a.out\n/testfs/</b> <br>\n--------------- nread=120 --------------- <br>\ninode# file type d_reclen d_off d_name <br>\n2 directory 16 12 . <br>\n2 directory 16 24 .. <br>\n11 directory 24 44 lost+found <br>\n12 regular 16 56 a <br>\n228929 directory 16 68 sub <br>\n16353 directory 16 80 sub2 <br>\n130817 directory 16 4096 sub3</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>Program\nsource</b> <br>\n#define _GNU_SOURCE <br>\n#include &lt;dirent.h&gt; /* Defines DT_* constants */ <br>\n#include &lt;fcntl.h&gt; <br>\n#include &lt;stdint.h&gt; <br>\n#include &lt;stdio.h&gt; <br>\n#include &lt;unistd.h&gt; <br>\n#include &lt;stdlib.h&gt; <br>\n#include &lt;sys/stat.h&gt; <br>\n#include &lt;sys/syscall.h&gt;</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">#define\nhandle_error(msg) \\ <br>\ndo { perror(msg); exit(EXIT_FAILURE); } while (0)</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">struct\nlinux_dirent { <br>\nunsigned long d_ino; <br>\noff_t d_off; <br>\nunsigned short d_reclen; <br>\nchar d_name[]; <br>\n};</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">#define\nBUF_SIZE 1024</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">int <br>\nmain(int argc, char *argv[]) <br>\n{ <br>\nint fd; <br>\nlong nread; <br>\nchar buf[BUF_SIZE]; <br>\nstruct linux_dirent *d; <br>\nchar d_type;</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">fd = open(argc\n&gt; 1 ? argv[1] : &quot;.&quot;, O_RDONLY | O_DIRECTORY);\n<br>\nif (fd == -1) <br>\nhandle_error(&quot;open&quot;);</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">for (;;) { <br>\nnread = syscall(SYS_getdents, fd, buf, BUF_SIZE); <br>\nif (nread == -1) <br>\nhandle_error(&quot;getdents&quot;);</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">if (nread == 0)\n<br>\nbreak;</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">printf(&quot;---------------\nnread=%d ---------------\\n&quot;, nread); <br>\nprintf(&quot;inode# file type d_reclen d_off\nd_name\\n&quot;); <br>\nfor (long bpos = 0; bpos &lt; nread;) { <br>\nd = (struct linux_dirent *) (buf + bpos); <br>\nprintf(&quot;%8ld &quot;, d-&gt;d_ino); <br>\nd_type = *(buf + bpos + d-&gt;d_reclen - 1); <br>\nprintf(&quot;%-10s &quot;, (d_type == DT_REG) ?\n&quot;regular&quot; : <br>\n(d_type == DT_DIR) ? &quot;directory&quot; : <br>\n(d_type == DT_FIFO) ? &quot;FIFO&quot; : <br>\n(d_type == DT_SOCK) ? &quot;socket&quot; : <br>\n(d_type == DT_LNK) ? &quot;symlink&quot; : <br>\n(d_type == DT_BLK) ? &quot;block dev&quot; : <br>\n(d_type == DT_CHR) ? &quot;char dev&quot; :\n&quot;???&quot;); <br>\nprintf(&quot;%4d %10jd %s\\n&quot;, d-&gt;d_reclen, <br>\n(intmax_t) d-&gt;d_off, d-&gt;d_name); <br>\nbpos += d-&gt;d_reclen; <br>\n} <br>\n}</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">exit(EXIT_SUCCESS);\n<br>\n}</p>\n\n<h2>SEE ALSO\n<a name=\"SEE ALSO\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><a href=\"https://man.page/2/readdir\">readdir(2)</a>,\n<a href=\"https://man.page/3/readdir\">readdir(3)</a>, <a href=\"https://man.page/7/inode\">inode(7)</a></p>\n\n<h2>COLOPHON\n<a name=\"COLOPHON\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">This page is\npart of release 5.10 of the Linux <i>man-pages</i> project.\nA description of the project, information about reporting\nbugs, and the latest version of this page, can be found at\nhttps://www.kernel.org/doc/man-pages/.</p>\n<hr>\n","headings":["<a href=\"#NAME\">NAME</a>","<a href=\"#SYNOPSIS\">SYNOPSIS</a>","<a href=\"#DESCRIPTION\">DESCRIPTION</a>","<a href=\"#RETURN VALUE\">RETURN VALUE</a>","<a href=\"#ERRORS\">ERRORS</a>","<a href=\"#CONFORMING TO\">CONFORMING TO</a>","<a href=\"#NOTES\">NOTES</a>","<a href=\"#EXAMPLES\">EXAMPLES</a>","<a href=\"#SEE ALSO\">SEE ALSO</a>","<a href=\"#COLOPHON\">COLOPHON</a>"],"level":2}