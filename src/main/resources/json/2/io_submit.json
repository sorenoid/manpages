{"name":"io_submit","body":"\n\n<h1 align=\"center\">IO_SUBMIT</h1>\n\n\n\n\n\n\n\n\n\n\n\n\n<hr>\n\n\n<h2>NAME\n<a name=\"NAME\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">io_submit -\nsubmit asynchronous I/O blocks for processing</p>\n\n<h2>SYNOPSIS\n<a name=\"SYNOPSIS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>#include\n&lt;linux/aio_abi.h&gt;</b> /* Defines needed types */</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>int\nio_submit(aio_context_t</b> <i>ctx_id</i><b>, long</b>\n<i>nr</i><b>, struct iocb **</b><i>iocbpp</i><b>);</b></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><i>Note</i>:\nThere is no glibc wrapper for this system call; see\nNOTES.</p>\n\n<h2>DESCRIPTION\n<a name=\"DESCRIPTION\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><i>Note</i>:\nthis page describes the raw Linux system call interface. The\nwrapper function provided by <i>libaio</i> uses a different\ntype for the <i>ctx_id</i> argument. See NOTES.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The\n<b>io_submit</b>() system call queues <i>nr</i> I/O request\nblocks for processing in the AIO context <i>ctx_id</i>. The\n<i>iocbpp</i> argument should be an array of <i>nr</i> AIO\ncontrol blocks, which will be submitted to context\n<i>ctx_id</i>.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The <i>iocb</i>\n(I/O control block) structure defined in\n<i>linux/aio_abi.h</i> defines the parameters that control\nthe I/O operation.</p>\n\n<p style=\"margin-left:17%; margin-top: 1em\">#include\n&lt;linux/aio_abi.h&gt;</p>\n\n<p style=\"margin-left:17%; margin-top: 1em\">struct iocb {\n<br>\n__u64 aio_data; <br>\n__u32 PADDED(aio_key, aio_rw_flags); <br>\n__u16 aio_lio_opcode; <br>\n__s16 aio_reqprio; <br>\n__u32 aio_fildes; <br>\n__u64 aio_buf; <br>\n__u64 aio_nbytes; <br>\n__s64 aio_offset; <br>\n__u64 aio_reserved2; <br>\n__u32 aio_flags; <br>\n__u32 aio_resfd; <br>\n};</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The fields of\nthis structure are as follows: <i><br>\naio_data</i></p>\n\n<p style=\"margin-left:22%;\">This data is copied into the\n<i>data</i> field of the <i>io_event</i> structure upon I/O\ncompletion (see <a href=\"https://man.page/2/io_getevents\">io_getevents(2)</a>).</p>\n\n<p style=\"margin-left:11%;\"><i>aio_key</i></p>\n\n<p style=\"margin-left:22%;\">This is an internal field used\nby the kernel. Do not modify this field after an\n<b>io_submit</b>() call.</p>\n\n<p style=\"margin-left:11%;\"><i>aio_rw_flags</i></p>\n\n<p style=\"margin-left:22%;\">This defines the R/W flags\npassed with structure. The valid values are: <b><br>\nRWF_APPEND</b> (since Linux 4.16)</p>\n\n<p style=\"margin-left:32%;\">Append data to the end of the\nfile. See the description of the flag of the same name in\n<a href=\"https://man.page/2/pwritev2\">pwritev2(2)</a> as well as the description of\n<b>O_APPEND</b> in <a href=\"https://man.page/2/open\">open(2)</a>. The <i>aio_offset</i>\nfield is ignored. The file offset is not changed.</p>\n\n<p style=\"margin-left:22%;\"><b>RWF_DSYNC</b> (since Linux\n4.13)</p>\n\n<p style=\"margin-left:32%;\">Write operation complete\naccording to requirement of synchronized I/O data integrity.\nSee the description of the flag of the same name in\n<a href=\"https://man.page/2/pwritev2\">pwritev2(2)</a> as well the description of <b>O_DSYNC</b>\nin <a href=\"https://man.page/2/open\">open(2)</a>.</p>\n\n<p style=\"margin-left:22%;\"><b>RWF_HIPRI</b> (since Linux\n4.13)</p>\n\n<p style=\"margin-left:32%;\">High priority request, poll if\npossible</p>\n\n<p style=\"margin-left:22%;\"><b>RWF_NOWAIT</b> (since Linux\n4.14)</p>\n\n<p style=\"margin-left:32%;\">Don&rsquo;t wait if the I/O\nwill block for operations such as file block allocations,\ndirty page flush, mutex locks, or a congested block device\ninside the kernel. If any of these conditions are met, the\ncontrol block is returned immediately with a return value of\n<b>-EAGAIN</b> in the <i>res</i> field of the\n<i>io_event</i> structure (see <a href=\"https://man.page/2/io_getevents\">io_getevents(2)</a>).</p>\n\n<p style=\"margin-left:22%;\"><b>RWF_SYNC</b> (since Linux\n4.13)</p>\n\n<p style=\"margin-left:32%;\">Write operation complete\naccording to requirement of synchronized I/O file integrity.\nSee the description of the flag of the same name in\n<a href=\"https://man.page/2/pwritev2\">pwritev2(2)</a> as well the description of <b>O_SYNC</b>\nin <a href=\"https://man.page/2/open\">open(2)</a>.</p>\n\n<p style=\"margin-left:11%;\"><i>aio_lio_opcode</i></p>\n\n<p style=\"margin-left:22%;\">This defines the type of I/O to\nbe performed by the <i>iocb</i> structure. The valid values\nare defined by the enum defined in\n<i>linux/aio_abi.h</i>:</p>\n\n<p style=\"margin-left:28%; margin-top: 1em\">enum { <br>\nIOCB_CMD_PREAD = 0, <br>\nIOCB_CMD_PWRITE = 1, <br>\nIOCB_CMD_FSYNC = 2, <br>\nIOCB_CMD_FDSYNC = 3, <br>\nIOCB_CMD_POLL = 5, <br>\nIOCB_CMD_NOOP = 6, <br>\nIOCB_CMD_PREADV = 7, <br>\nIOCB_CMD_PWRITEV = 8, <br>\n};</p>\n\n<p style=\"margin-left:11%;\"><i>aio_reqprio</i></p>\n\n<p style=\"margin-left:22%;\">This defines the requests\npriority.</p>\n\n<p style=\"margin-left:11%;\"><i>aio_fildes</i></p>\n\n<p style=\"margin-left:22%;\">The file descriptor on which\nthe I/O operation is to be performed.</p>\n\n<p style=\"margin-left:11%;\"><i>aio_buf</i></p>\n\n<p style=\"margin-left:22%;\">This is the buffer used to\ntransfer data for a read or write operation.</p>\n\n<p style=\"margin-left:11%;\"><i>aio_nbytes</i></p>\n\n<p style=\"margin-left:22%;\">This is the size of the buffer\npointed to by <i>aio_buf</i>.</p>\n\n<p style=\"margin-left:11%;\"><i>aio_offset</i></p>\n\n<p style=\"margin-left:22%;\">This is the file offset at\nwhich the I/O operation is to be performed.</p>\n\n<p style=\"margin-left:11%;\"><i>aio_flags</i></p>\n\n<p style=\"margin-left:22%;\">This is the set of flags\nassociated with the <i>iocb</i> structure. The valid values\nare: <b><br>\nIOCB_FLAG_RESFD</b></p>\n\n<p style=\"margin-left:32%;\">Asynchronous I/O control must\nsignal the file descriptor mentioned in <i>aio_resfd</i>\nupon completion.</p>\n\n<p style=\"margin-left:22%;\"><b>IOCB_FLAG_IOPRIO</b> (since\nLinux 4.18)</p>\n\n<p style=\"margin-left:32%;\">Interpret the\n<i>aio_reqprio</i> field as an <b>IOPRIO_VALUE</b> as\ndefined by <i>linux/ioprio.h</i>.</p>\n\n<p style=\"margin-left:11%;\"><i>aio_resfd</i></p>\n\n<p style=\"margin-left:22%;\">The file descriptor to signal\nin the event of asynchronous I/O completion.</p>\n\n<h2>RETURN VALUE\n<a name=\"RETURN VALUE\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">On success,\n<b>io_submit</b>() returns the number of <i>iocb</i>s\nsubmitted (which may be less than <i>nr</i>, or 0 if\n<i>nr</i> is zero). For the failure return, see NOTES.</p>\n\n<h2>ERRORS\n<a name=\"ERRORS\"></a>\n</h2>\n\n\n<table width=\"100%\" border=\"0\" rules=\"none\" frame=\"void\"\n       cellspacing=\"0\" cellpadding=\"0\">\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p style=\"margin-top: 1em\"><b>EAGAIN</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p style=\"margin-top: 1em\">Insufficient resources are\navailable to queue any <i>iocb</i>s.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EBADF</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>The file descriptor specified in the first <i>iocb</i>\nis invalid.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EFAULT</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>One of the data structures points to invalid data.</p></td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EINVAL</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>The AIO context specified by <i>ctx_id</i> is invalid.\n<i>nr</i> is less than 0. The <i>iocb</i> at\n<i>*iocbpp[0]</i> is not properly initialized, the operation\nspecified is invalid for the file descriptor in the\n<i>iocb</i>, or the value in the <i>aio_reqprio</i> field is\ninvalid.</p> </td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>ENOSYS</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p><b>io_submit</b>() is not implemented on this\narchitecture.</p> </td></tr>\n<tr valign=\"top\" align=\"left\">\n<td width=\"11%\"></td>\n<td width=\"9%\">\n\n\n<p><b>EPERM</b></p></td>\n<td width=\"2%\"></td>\n<td width=\"78%\">\n\n\n<p>The <i>aio_reqprio</i> field is set with the class\n<b>IOPRIO_CLASS_RT</b>, but the submitting context does not\nhave the <b>CAP_SYS_ADMIN</b> capability.</p></td></tr>\n</table>\n\n<h2>VERSIONS\n<a name=\"VERSIONS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">The\nasynchronous I/O system calls first appeared in Linux\n2.5.</p>\n\n<h2>CONFORMING TO\n<a name=\"CONFORMING TO\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>io_submit</b>()\nis Linux-specific and should not be used in programs that\nare intended to be portable.</p>\n\n<h2>NOTES\n<a name=\"NOTES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Glibc does not\nprovide a wrapper function for this system call. You could\ninvoke it using <a href=\"https://man.page/2/syscall\">syscall(2)</a>. But instead, you probably\nwant to use the <b>io_submit</b>() wrapper function provided\nby <i>libaio</i>.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Note that the\n<i>libaio</i> wrapper function uses a different type\n(<i>io_context_t</i>) for the <i>ctx_id</i> argument. Note\nalso that the <i>libaio</i> wrapper does not follow the\nusual C library conventions for indicating errors: on error\nit returns a negated error number (the negative of one of\nthe values listed in ERRORS). If the system call is invoked\nvia <a href=\"https://man.page/2/syscall\">syscall(2)</a>, then the return value follows the\nusual conventions for indicating an error: -1, with\n<i>errno</i> set to a (positive) value that indicates the\nerror.</p>\n\n<h2>SEE ALSO\n<a name=\"SEE ALSO\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><a href=\"https://man.page/2/io_cancel\">io_cancel(2)</a>,\n<a href=\"https://man.page/2/io_destroy\">io_destroy(2)</a>, <a href=\"https://man.page/2/io_getevents\">io_getevents(2)</a>,\n<a href=\"https://man.page/2/io_setup\">io_setup(2)</a>, <a href=\"https://man.page/7/aio\">aio(7)</a></p>\n\n<h2>COLOPHON\n<a name=\"COLOPHON\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">This page is\npart of release 5.10 of the Linux <i>man-pages</i> project.\nA description of the project, information about reporting\nbugs, and the latest version of this page, can be found at\nhttps://www.kernel.org/doc/man-pages/.</p>\n<hr>\n","headings":["<a href=\"#NAME\">NAME</a>","<a href=\"#SYNOPSIS\">SYNOPSIS</a>","<a href=\"#DESCRIPTION\">DESCRIPTION</a>","<a href=\"#RETURN VALUE\">RETURN VALUE</a>","<a href=\"#ERRORS\">ERRORS</a>","<a href=\"#VERSIONS\">VERSIONS</a>","<a href=\"#CONFORMING TO\">CONFORMING TO</a>","<a href=\"#NOTES\">NOTES</a>","<a href=\"#SEE ALSO\">SEE ALSO</a>","<a href=\"#COLOPHON\">COLOPHON</a>"],"level":2}