{"name":"flock","description":"flock - manage\nlocks from shell scripts","body":"\n\n<h1 align=\"center\">FLOCK</h1>\n\n\n\n\n\n\n\n\n\n\n\n\n\n<hr>\n\n\n<h2>NAME\n<a name=\"NAME\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">flock - manage\nlocks from shell scripts</p>\n\n<h2>SYNOPSIS\n<a name=\"SYNOPSIS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>flock</b>\n[options] <i>file</i>|<i>directory command</i>\n[<i>arguments</i>]</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>flock</b>\n[options] <i>file</i>|<i>directory</i> <b>-c</b>\n<i>command</i></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>flock</b>\n[options] <i>number</i></p>\n\n<h2>DESCRIPTION\n<a name=\"DESCRIPTION\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">This utility\nmanages <a href=\"https://man.page/2/flock\">flock(2)</a> locks from within shell scripts or\nfrom the command line.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The first and\nsecond of the above forms wrap the lock around the execution\nof a <i>command</i>, in a manner similar to <a href=\"https://man.page/1/su\">su(1)</a> or\n<a href=\"https://man.page/1/newgrp\">newgrp(1)</a>. They lock a specified <i>file</i> or\n<i>directory</i>, which is created (assuming appropriate\npermissions) if it does not already exist. By default, if\nthe lock cannot be immediately acquired, <b>flock</b> waits\nuntil the lock is available.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">The third form\nuses an open file by its file descriptor <i>number</i>. See\nthe examples below for how that can be used.</p>\n\n<h2>OPTIONS\n<a name=\"OPTIONS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>-c</b>,\n<b>--command</b> <i>command</i></p>\n\n<p style=\"margin-left:17%;\">Pass a single <i>command</i>,\nwithout arguments, to the shell with <b>-c</b>.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>-E</b>,\n<b>--conflict-exit-code</b> <i>number</i></p>\n\n<p style=\"margin-left:17%;\">The exit status used when the\n<b>-n</b> option is in use, and the conflicting lock exists,\nor the <b>-w</b> option is in use, and the timeout is\nreached. The default value is <b>1</b>. The <i>number</i>\nhas to be in the range of 0 to 255.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>-F</b>,\n<b>--no-fork</b></p>\n\n<p style=\"margin-left:17%;\">Do not fork before executing\n<i>command</i>. Upon execution the flock process is replaced\nby <i>command</i> which continues to hold the lock. This\noption is incompatible with <b>--close</b> as there would\notherwise be nothing left to hold the lock.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>-e</b>,\n<b>-x</b>, <b>--exclusive</b></p>\n\n<p style=\"margin-left:17%;\">Obtain an exclusive lock,\nsometimes called a write lock. This is the default.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>-n</b>,\n<b>--nb</b>, <b>--nonblock</b></p>\n\n<p style=\"margin-left:17%;\">Fail rather than wait if the\nlock cannot be immediately acquired. See the <b>-E</b>\noption for the exit status used.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>-o</b>,\n<b>--close</b></p>\n\n<p style=\"margin-left:17%;\">Close the file descriptor on\nwhich the lock is held before executing <i>command</i>. This\nis useful if <i>command</i> spawns a child process which\nshould not be holding the lock.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>-s</b>,\n<b>--shared</b></p>\n\n<p style=\"margin-left:17%;\">Obtain a shared lock, sometimes\ncalled a read lock.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>-u</b>,\n<b>--unlock</b></p>\n\n<p style=\"margin-left:17%;\">Drop a lock. This is usually\nnot required, since a lock is automatically dropped when the\nfile is closed. However, it may be required in special\ncases, for example if the enclosed command group may have\nforked a background process which should not be holding the\nlock.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>-w</b>,\n<b>--wait</b>, <b>--timeout</b> <i>seconds</i></p>\n\n<p style=\"margin-left:17%;\">Fail if the lock cannot be\nacquired within <i>seconds</i>. Decimal fractional values\nare allowed. See the <b>-E</b> option for the exit status\nused. The zero number of <i>seconds</i> is interpreted as\n<b>--nonblock</b>.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>--verbose</b></p>\n\n<p style=\"margin-left:17%;\">Report how long it took to\nacquire the lock, or why the lock could not be obtained.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>-V</b>,\n<b>--version</b></p>\n\n<p style=\"margin-left:17%;\">Display version information and\nexit.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>-h</b>,\n<b>--help</b></p>\n\n<p style=\"margin-left:17%;\">Display help text and exit.</p>\n\n<h2>EXIT STATUS\n<a name=\"EXIT STATUS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">The command\nuses &lt;sysexits.h&gt; exit status values for everything,\nexcept when using either of the options <b>-n</b> or\n<b>-w</b> which report a failure to acquire the lock with an\nexit status given by the <b>-E</b> option, or 1 by default.\nThe exit status given by <b>-E</b> has to be in the range of\n0 to 255.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">When using the\n<i>command</i> variant, and executing the child worked, then\nthe exit status is that of the child command.</p>\n\n<h2>EXAMPLES\n<a name=\"EXAMPLES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Note that\n&quot;shell&gt; &quot; in examples is a command line\nprompt.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">shell1&gt;\nflock /tmp -c cat; shell2&gt; flock -w .007 /tmp -c echo;\n/bin/echo $?</p>\n\n<p style=\"margin-left:17%;\">Set exclusive lock to directory\n/tmp and the second command will fail.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">shell1&gt;\nflock -s /tmp -c cat; shell2&gt; flock -s -w .007 /tmp -c\necho; /bin/echo $?</p>\n\n<p style=\"margin-left:17%;\">Set shared lock to directory\n/tmp and the second command will not fail. Notice that\nattempting to get exclusive lock with second command would\nfail.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">shell&gt; flock\n-x local-lock-file echo 'a b c'</p>\n\n<p style=\"margin-left:17%;\">Grab the exclusive lock\n&quot;local-lock-file&quot; before running echo with 'a b\nc'.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">(; flock -n 9\n|| exit 1; # ... commands executed under lock ...; )\n9&gt;/var/lock/mylockfile</p>\n\n<p style=\"margin-left:17%;\">The form is convenient inside\nshell scripts. The mode used to open the file doesn&rsquo;t\nmatter to <b>flock</b>; using <i>&gt;</i> or <i>&gt;&gt;</i>\nallows the lockfile to be created if it does not already\nexist, however, write permission is required. Using\n<i>&lt;</i> requires that the file already exists but only\nread permission is required.</p>\n\n<p style=\"margin-left:17%; margin-top: 1em\">[ ${FLOCKER} !=\n$0 ] &amp;&amp; exec env FLOCKER=&quot;$0 flock -en $0 $0 $@\n||</p>\n\n<p style=\"margin-left:23%;\">This is useful boilerplate code\nfor shell scripts. Put it at the top of the shell script you\nwant to lock and it&rsquo;ll automatically lock itself on\nthe first run. If the env var <b>$FLOCKER</b> is not set to\nthe shell script that is being run, then execute\n<b>flock</b> and grab an exclusive non-blocking lock (using\nthe script itself as the lock file) before re-execing itself\nwith the right arguments. It also sets the FLOCKER env var\nto the right value so it doesn&rsquo;t run again.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">shell&gt; exec\n4&lt;&gt;/var/lock/mylockfile; shell&gt; flock -n 4</p>\n\n<p style=\"margin-left:17%;\">This form is convenient for\nlocking a file without spawning a subprocess. The shell\nopens the lock file for reading and writing as file\ndescriptor 4, then flock is used to lock the descriptor.</p>\n\n<h2>AUTHORS\n<a name=\"AUTHORS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><i>H. Peter\nAnvin</i> &lt;hpa@zytor.com&gt;</p>\n\n<h2>COPYRIGHT\n<a name=\"COPYRIGHT\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Copyright\n&Acirc;&copy; 2003-2006 H. Peter Anvin. This is free\nsoftware; see the source for copying conditions. There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A\nPARTICULAR PURPOSE.</p>\n\n<h2>SEE ALSO\n<a name=\"SEE ALSO\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><a href=\"https://man.page/2/flock\">flock(2)</a></p>\n\n<h2>REPORTING BUGS\n<a name=\"REPORTING BUGS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">For bug\nreports, use the issue tracker at\n&lt;https://github.com/karelzak/util-linux/issues&gt;.</p>\n\n<h2>AVAILABILITY\n<a name=\"AVAILABILITY\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">The\n<b>flock</b> command is part of the util-linux package which\ncan be downloaded from <i>Linux Kernel Archive</i>\n&lt;https://www.kernel.org/pub/linux/utils/util-linux/&gt;.</p>\n<hr>\n","headings":["<a href=\"#NAME\">NAME</a>","<a href=\"#SYNOPSIS\">SYNOPSIS</a>","<a href=\"#DESCRIPTION\">DESCRIPTION</a>","<a href=\"#OPTIONS\">OPTIONS</a>","<a href=\"#EXIT STATUS\">EXIT STATUS</a>","<a href=\"#EXAMPLES\">EXAMPLES</a>","<a href=\"#AUTHORS\">AUTHORS</a>","<a href=\"#COPYRIGHT\">COPYRIGHT</a>","<a href=\"#SEE ALSO\">SEE ALSO</a>","<a href=\"#REPORTING BUGS\">REPORTING BUGS</a>","<a href=\"#AVAILABILITY\">AVAILABILITY</a>"]}