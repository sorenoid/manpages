{"name":"setpriv","description":"setpriv - run a\nprogram with different Linux privilege settings","body":"\n\n<h1 align=\"center\">SETPRIV</h1>\n\n\n\n\n\n\n\n\n\n\n\n\n<hr>\n\n\n<h2>NAME\n<a name=\"NAME\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">setpriv - run a\nprogram with different Linux privilege settings</p>\n\n<h2>SYNOPSIS\n<a name=\"SYNOPSIS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>setpriv</b>\n[options] <i>program</i> [<i>arguments</i>]</p>\n\n<h2>DESCRIPTION\n<a name=\"DESCRIPTION\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">Sets or queries\nvarious Linux privilege settings that are inherited across\n<a href=\"https://man.page/2/execve\">execve(2)</a>.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">In comparison\nto <a href=\"https://man.page/1/su\">su(1)</a> and <a href=\"https://man.page/1/runuser\">runuser(1)</a>, <b>setpriv</b>\nneither uses PAM, nor does it prompt for a password. It is a\nsimple, non-set-user-ID wrapper around <a href=\"https://man.page/2/execve\">execve(2)</a>, and\ncan be used to drop privileges in the same way as\n<b>setuidgid</b>(8) from <b>daemontools</b>, <b>chpst</b>(8)\nfrom <b>runit</b>, or similar tools shipped by other service\nmanagers.</p>\n\n<h2>OPTIONS\n<a name=\"OPTIONS\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>--clear-groups</b></p>\n\n<p style=\"margin-left:17%;\">Clear supplementary groups.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>-d</b>,\n<b>--dump</b></p>\n\n<p style=\"margin-left:17%;\">Dump the current privilege\nstate. This option can be specified more than once to show\nextra, mostly useless, information. Incompatible with all\nother options.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>--groups</b>\n<i>group</i>...</p>\n\n<p style=\"margin-left:17%;\">Set supplementary groups. The\nargument is a comma-separated list of GIDs or names.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>--inh-caps</b>\n(<b>+</b>|<b>-</b>)<i>cap</i>..., <b>--ambient-caps</b>\n(<b>+</b>|<b>-</b>)<i>cap</i>..., <b>--bounding-set</b>\n(<b>+</b>|<b>-</b>)<i>cap</i>...</p>\n\n<p style=\"margin-left:17%;\">Set the inheritable\ncapabilities, ambient capabilities or the capability\nbounding set. See <a href=\"https://man.page/7/capabilities\">capabilities(7)</a>. The argument is a\ncomma-separated list of <b>+</b><i>cap</i> and\n<b>-</b><i>cap</i> entries, which add or remove an entry\nrespectively. <i>cap</i> can either be a human-readable name\nas seen in <a href=\"https://man.page/7/capabilities\">capabilities(7)</a> without the <i>cap_</i>\nprefix or of the format <b>cap_N</b>, where <i>N</i> is the\ninternal capability index used by Linux. <b>+all</b> and\n<b>-all</b> can be used to add or remove all caps.</p>\n\n<p style=\"margin-left:17%; margin-top: 1em\">The set of\ncapabilities starts out as the current inheritable set for\n<b>--inh-caps</b>, the current ambient set for\n<b>--ambient-caps</b> and the current bounding set for\n<b>--bounding-set</b>.</p>\n\n<p style=\"margin-left:17%; margin-top: 1em\">Note the\nfollowing restrictions (detailed in <a href=\"https://man.page/7/capabilities\">capabilities(7)</a>)\nregarding modifications to these capability sets:</p>\n\n<p style=\"margin-left:23%; margin-top: 1em\">&bull; A\ncapability can be added to the inheritable set only if it is\ncurrently present in the bounding set.</p>\n\n<p style=\"margin-left:23%; margin-top: 1em\">&bull; A\ncapability can be added to the ambient set only if it is\ncurrently present in both the permitted and inheritable\nsets.</p>\n\n<p style=\"margin-left:23%; margin-top: 1em\">&bull;\nNotwithstanding the syntax offered by <b>setpriv</b>, the\nkernel does not permit capabilities to be added to the\nbounding set.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">If you drop a\ncapability from the bounding set without also dropping it\nfrom the inheritable set, you are likely to become confused.\nDo not do that.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>--keep-groups</b></p>\n\n<p style=\"margin-left:17%;\">Preserve supplementary groups.\nOnly useful in conjunction with <b>--rgid</b>,\n<b>--egid</b>, or <b>--regid</b>.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>--init-groups</b></p>\n\n<p style=\"margin-left:17%;\">Initialize supplementary groups\nusing initgroups3. Only useful in conjunction with\n<b>--ruid</b> or <b>--reuid</b>.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>--list-caps</b></p>\n\n<p style=\"margin-left:17%;\">List all known capabilities.\nThis option must be specified alone.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>--no-new-privs</b></p>\n\n<p style=\"margin-left:17%;\">Set the <i>no_new_privs</i>\nbit. With this bit set, <a href=\"https://man.page/2/execve\">execve(2)</a> will not grant new\nprivileges. For example, the set-user-ID and set-group-ID\nbits as well as file capabilities will be disabled.\n(Executing binaries with these bits set will still work, but\nthey will not gain privileges. Certain LSMs, especially\nAppArmor, may result in failures to execute certain\nprograms.) This bit is inherited by child processes and\ncannot be unset. See <a href=\"https://man.page/2/prctl\">prctl(2)</a> and\n<i>Documentation/prctl/no_new_privs.txt</i> in the Linux\nkernel source.</p>\n\n<p style=\"margin-left:17%; margin-top: 1em\">The\n<i>no_new_privs</i> bit is supported since Linux 3.5.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>--rgid</b>\n<i>gid</i>, <b>--egid</b> <i>gid</i>, <b>--regid</b>\n<i>gid</i></p>\n\n<p style=\"margin-left:17%;\">Set the real, effective, or\nboth GIDs. The <i>gid</i> argument can be given as a textual\ngroup name.</p>\n\n<p style=\"margin-left:17%; margin-top: 1em\">For safety, you\nmust specify one of <b>--clear-groups</b>, <b>--groups</b>,\n<b>--keep-groups</b>, or <b>--init-groups</b> if you set any\nprimary <i>gid</i>.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>--ruid</b>\n<i>uid</i>, <b>--euid</b> <i>uid</i>, <b>--reuid</b>\n<i>uid</i></p>\n\n<p style=\"margin-left:17%;\">Set the real, effective, or\nboth UIDs. The <i>uid</i> argument can be given as a textual\nlogin name.</p>\n\n<p style=\"margin-left:17%; margin-top: 1em\">Setting a\n<i>uid</i> or <i>gid</i> does not change capabilities,\nalthough the exec call at the end might change capabilities.\nThis means that, if you are root, you probably want to do\nsomething like:</p>\n\n<p style=\"margin-left:17%; margin-top: 1em\"><b>setpriv\n--reuid=1000 --regid=1000 --inh-caps=-all</b></p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>--securebits</b>\n(<b>+</b>|<b>-</b>)<i>securebit</i>...</p>\n\n<p style=\"margin-left:17%;\">Set or clear securebits. The\nargument is a comma-separated list. The valid securebits are\n<i>noroot</i>, <i>noroot_locked</i>, <i>no_setuid_fixup</i>,\n<i>no_setuid_fixup_locked</i>, and <i>keep_caps_locked</i>.\n<i>keep_caps</i> is cleared by <a href=\"https://man.page/2/execve\">execve(2)</a> and is\ntherefore not allowed.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>--pdeathsig\nkeep</b>|<b>clear</b>|<b>&lt;signal&gt;</b></p>\n\n<p style=\"margin-left:17%;\">Keep, clear or set the parent\ndeath signal. Some LSMs, most notably SELinux and AppArmor,\nclear the signal when the process' credentials change. Using\n<b>--pdeathsig keep</b> will restore the parent death signal\nafter changing credentials to remedy that situation.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>--selinux-label</b>\n<i>label</i></p>\n\n<p style=\"margin-left:17%;\">Request a particular SELinux\ntransition (using a transition on exec, not dyntrans). This\nwill fail and cause <b>setpriv</b> to abort if SELinux is\nnot in use, and the transition may be ignored or cause\n<a href=\"https://man.page/2/execve\">execve(2)</a> to fail at SELinux&rsquo;s whim. (In\nparticular, this is unlikely to work in conjunction with\n<i>no_new_privs</i>.) This is similar to\n<a href=\"https://man.page/1/runcon\">runcon(1)</a>.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>--apparmor-profile</b>\n<i>profile</i></p>\n\n<p style=\"margin-left:17%;\">Request a particular AppArmor\nprofile (using a transition on exec). This will fail and\ncause <b>setpriv</b> to abort if AppArmor is not in use, and\nthe transition may be ignored or cause <a href=\"https://man.page/2/execve\">execve(2)</a> to\nfail at AppArmor&rsquo;s whim.</p>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>--reset-env</b></p>\n\n<p style=\"margin-left:17%;\">Clears all the environment\nvariables except <b>TERM</b>; initializes the environment\nvariables <b>HOME</b>, <b>SHELL</b>, <b>USER</b>,\n<b>LOGNAME</b> according to the user&rsquo;s passwd entry;\nsets <b>PATH</b> to <i>/usr/local/bin:/bin:/usr/bin</i> for\na regular user and to\n<i>/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</i>\nfor root.</p>\n\n<p style=\"margin-left:17%; margin-top: 1em\">The environment\nvariable <b>PATH</b> may be different on systems where\n<i>/bin</i> and <i>/sbin</i> are merged into <i>/usr</i>.\nThe environment variable <b>SHELL</b> defaults to\n<b>/bin/sh</b> if none is given in the user&rsquo;s passwd\nentry.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>-V</b>,\n<b>--version</b></p>\n\n<p style=\"margin-left:17%;\">Display version information and\nexit.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>-h</b>,\n<b>--help</b></p>\n\n<p style=\"margin-left:17%;\">Display help text and exit.</p>\n\n<h2>NOTES\n<a name=\"NOTES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">If applying any\nspecified option fails, <i>program</i> will not be run and\n<b>setpriv</b> will return with exit status 127.</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">Be careful with\nthis tool &mdash; it may have unexpected security\nconsequences. For example, setting <i>no_new_privs</i> and\nthen execing a program that is SELinux-confined (as this\ntool would do) may prevent the SELinux restrictions from\ntaking effect.</p>\n\n<h2>EXAMPLES\n<a name=\"EXAMPLES\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">If you&rsquo;re\nlooking for behavior similar to\n<a href=\"https://man.page/1/su\">su(1)</a>/<a href=\"https://man.page/1/runuser\">runuser(1)</a>, or <b>sudo</b>(8) (without\nthe <b>-g</b> option), try something like:</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>setpriv\n--reuid=1000 --regid=1000 --init-groups</b></p>\n\n<p style=\"margin-left:11%; margin-top: 1em\">If you want to\nmimic daemontools' <b>setuid</b>(8), try:</p>\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b>setpriv\n--reuid=1000 --regid=1000 --clear-groups</b></p>\n\n<h2>AUTHORS\n<a name=\"AUTHORS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><b><i>Andy\nLutomirski</i></b> &lt;luto@amacapital.net&gt;</p>\n\n<h2>SEE ALSO\n<a name=\"SEE ALSO\"></a>\n</h2>\n\n\n\n<p style=\"margin-left:11%; margin-top: 1em\"><a href=\"https://man.page/1/runuser\">runuser(1)</a>,\n<a href=\"https://man.page/1/su\">su(1)</a>, <a href=\"https://man.page/2/prctl\">prctl(2)</a>, <a href=\"https://man.page/7/capabilities\">capabilities(7)</a></p>\n\n<h2>REPORTING BUGS\n<a name=\"REPORTING BUGS\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">For bug\nreports, use the issue tracker at\n&lt;https://github.com/karelzak/util-linux/issues&gt;.</p>\n\n<h2>AVAILABILITY\n<a name=\"AVAILABILITY\"></a>\n</h2>\n\n\n<p style=\"margin-left:11%; margin-top: 1em\">The\n<b>setpriv</b> command is part of the util-linux package\nwhich can be downloaded from <i>Linux Kernel Archive</i>\n&lt;https://www.kernel.org/pub/linux/utils/util-linux/&gt;.</p>\n<hr>\n","headings":["<a href=\"#NAME\">NAME</a>","<a href=\"#SYNOPSIS\">SYNOPSIS</a>","<a href=\"#DESCRIPTION\">DESCRIPTION</a>","<a href=\"#OPTIONS\">OPTIONS</a>","<a href=\"#NOTES\">NOTES</a>","<a href=\"#EXAMPLES\">EXAMPLES</a>","<a href=\"#AUTHORS\">AUTHORS</a>","<a href=\"#SEE ALSO\">SEE ALSO</a>","<a href=\"#REPORTING BUGS\">REPORTING BUGS</a>","<a href=\"#AVAILABILITY\">AVAILABILITY</a>"]}