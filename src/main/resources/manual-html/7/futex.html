<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Sat Nov 26 20:39:43 2022 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>FUTEX</title>

</head>
<body>

<h1 align="center">FUTEX</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#VERSIONS">VERSIONS</a><br>
<a href="#NOTES">NOTES</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#COLOPHON">COLOPHON</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">futex - fast
user-space locking</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>#include
&lt;linux/futex.h&gt;</b></p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The Linux
kernel provides futexes (&quot;Fast user-space
mutexes&quot;) as a building block for fast user-space
locking and semaphores. Futexes are very basic and lend
themselves well for building higher-level locking
abstractions such as mutexes, condition variables,
read-write locks, barriers, and semaphores.</p>

<p style="margin-left:11%; margin-top: 1em">Most
programmers will in fact not be using futexes directly but
will instead rely on system libraries built on them, such as
the Native POSIX Thread Library (NPTL) (see
<a href="https://man.page/7/pthreads">pthreads(7)</a>).</p>

<p style="margin-left:11%; margin-top: 1em">A futex is
identified by a piece of memory which can be shared between
processes or threads. In these different processes, the
futex need not have identical addresses. In its bare form, a
futex has semaphore semantics; it is a counter that can be
incremented and decremented atomically; processes can wait
for the value to become positive.</p>

<p style="margin-left:11%; margin-top: 1em">Futex operation
occurs entirely in user space for the noncontended case. The
kernel is involved only to arbitrate the contended case. As
any sane design will strive for noncontention, futexes are
also optimized for this situation.</p>

<p style="margin-left:11%; margin-top: 1em">In its bare
form, a futex is an aligned integer which is touched only by
atomic assembler instructions. This integer is four bytes
long on all platforms. Processes can share this integer
using <a href="https://man.page/2/mmap">mmap(2)</a>, via shared memory segments, or because
they share memory space, in which case the application is
commonly called multithreaded.</p>


<p style="margin-left:11%; margin-top: 1em"><b>Semantics</b>
<br>
Any futex operation starts in user space, but it may be
necessary to communicate with the kernel using the
<a href="https://man.page/2/futex">futex(2)</a> system call.</p>

<p style="margin-left:11%; margin-top: 1em">To
&quot;up&quot; a futex, execute the proper assembler
instructions that will cause the host CPU to atomically
increment the integer. Afterward, check if it has in fact
changed from 0 to 1, in which case there were no waiters and
the operation is done. This is the noncontended case which
is fast and should be common.</p>

<p style="margin-left:11%; margin-top: 1em">In the
contended case, the atomic increment changed the counter
from -1 (or some other negative number). If this is
detected, there are waiters. User space should now set the
counter to 1 and instruct the kernel to wake up any waiters
using the <b>FUTEX_WAKE</b> operation.</p>

<p style="margin-left:11%; margin-top: 1em">Waiting on a
futex, to &quot;down&quot; it, is the reverse operation.
Atomically decrement the counter and check if it changed to
0, in which case the operation is done and the futex was
uncontended. In all other circumstances, the process should
set the counter to -1 and request that the kernel wait for
another process to up the futex. This is done using the
<b>FUTEX_WAIT</b> operation.</p>

<p style="margin-left:11%; margin-top: 1em">The
<a href="https://man.page/2/futex">futex(2)</a> system call can optionally be passed a
timeout specifying how long the kernel should wait for the
futex to be upped. In this case, semantics are more complex
and the programmer is referred to <a href="https://man.page/2/futex">futex(2)</a> for more
details. The same holds for asynchronous futex waiting.</p>

<h2>VERSIONS
<a name="VERSIONS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">Initial futex
support was merged in Linux 2.5.7 but with different
semantics from those described above. Current semantics are
available from Linux 2.5.40 onward.</p>

<h2>NOTES
<a name="NOTES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">To reiterate,
bare futexes are not intended as an easy-to-use abstraction
for end users. Implementors are expected to be assembly
literate and to have read the sources of the futex
user-space library referenced below.</p>

<p style="margin-left:11%; margin-top: 1em">This man page
illustrates the most common use of the <a href="https://man.page/2/futex">futex(2)</a>
primitives; it is by no means the only one.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><a href="https://man.page/2/clone">clone(2)</a>,
<a href="https://man.page/2/futex">futex(2)</a>, <a href="https://man.page/2/get_robust_list">get_robust_list(2)</a>,
<a href="https://man.page/2/set_robust_list">set_robust_list(2)</a>, <a href="https://man.page/2/set_tid_address">set_tid_address(2)</a>,
<a href="https://man.page/7/pthreads">pthreads(7)</a></p>

<p style="margin-left:11%; margin-top: 1em"><i>Fuss,
Futexes and Furwocks: Fast Userlevel Locking in Linux</i>
(proceedings of the Ottawa Linux Symposium 2002), futex
example library, futex-*.tar.bz2
<a href="ftp://ftp.kernel.org/pub/linux/kernel/people/rusty/">ftp://ftp.kernel.org/pub/linux/kernel/people/rusty/</a>.</p>

<h2>COLOPHON
<a name="COLOPHON"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This page is
part of release 5.10 of the Linux <i>man-pages</i> project.
A description of the project, information about reporting
bugs, and the latest version of this page, can be found at
https://www.kernel.org/doc/man-pages/.</p>
<hr>
</body>
</html>
