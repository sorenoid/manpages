<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Sat Nov 26 20:37:25 2022 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>RESOLVER</title>

</head>
<body>

<h1 align="center">RESOLVER</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#RETURN VALUE">RETURN VALUE</a><br>
<a href="#FILES">FILES</a><br>
<a href="#ATTRIBUTES">ATTRIBUTES</a><br>
<a href="#CONFORMING TO">CONFORMING TO</a><br>
<a href="#SEE ALSO">SEE ALSO</a><br>
<a href="#COLOPHON">COLOPHON</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">res_ninit,
res_nclose, res_nquery, res_nsearch, res_nquerydomain,
res_nmkquery, res_nsend, res_init, res_query, res_search,
res_querydomain, res_mkquery, res_send, dn_comp, dn_expand -
resolver routines</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>#include
&lt;netinet/in.h&gt; <br>
#include &lt;arpa/nameser.h&gt; <br>
#include &lt;resolv.h&gt;</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>struct
__res_state; <br>
typedef struct __res_state *res_state;</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
res_ninit(res_state</b> <i>statep</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>void
res_nclose(res_state</b> <i>statep</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
res_nquery(res_state</b> <i>statep</i><b>, <br>
const char *</b><i>dname</i><b>, int</b> <i>class</i><b>,
int</b> <i>type</i><b>, <br>
unsigned char *</b><i>answer</i><b>, int</b>
<i>anslen</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
res_nsearch(res_state</b> <i>statep</i><b>, <br>
const char *</b><i>dname</i><b>, int</b> <i>class</i><b>,
int</b> <i>type</i><b>, <br>
unsigned char *</b><i>answer</i><b>, int</b>
<i>anslen</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
res_nquerydomain(res_state</b> <i>statep</i><b>, <br>
const char *</b><i>name</i><b>, const char
*</b><i>domain</i><b>, <br>
int</b> <i>class</i><b>, int</b> <i>type</i><b>, unsigned
char *</b><i>answer</i><b>, <br>
int</b> <i>anslen</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
res_nmkquery(res_state</b> <i>statep</i><b>, <br>
int</b> <i>op</i><b>, const char *</b><i>dname</i><b>,
int</b> <i>class</i><b>, <br>
int</b> <i>type</i><b>, const unsigned char
*</b><i>data</i><b>, int</b> <i>datalen</i><b>, <br>
const unsigned char *</b><i>newrr</i><b>, <br>
unsigned char *</b><i>buf</i><b>, int</b>
<i>buflen</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
res_nsend(res_state</b> <i>statep</i><b>, <br>
const unsigned char *</b><i>msg</i><b>, int</b>
<i>msglen</i><b>, <br>
unsigned char *</b><i>answer</i><b>, int</b>
<i>anslen</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
dn_comp(const char *</b><i>exp_dn</i><b>, unsigned char
*</b><i>comp_dn</i><b>, <br>
int</b> <i>length</i><b>, unsigned char
**</b><i>dnptrs</i><b>, <br>
unsigned char **</b><i>lastdnptr</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
dn_expand(const unsigned char *</b><i>msg</i><b>, <br>
const unsigned char *</b><i>eomorig</i><b>, <br>
const unsigned char *</b><i>comp_dn</i><b>, char
*</b><i>exp_dn</i><b>, <br>
int</b> <i>length</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>Deprecated
<br>
extern struct __res_state _res;</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
res_init(void);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
res_query(const char *</b><i>dname</i><b>, int</b>
<i>class</i><b>, int</b> <i>type</i><b>, <br>
unsigned char *</b><i>answer</i><b>, int</b>
<i>anslen</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
res_search(const char *</b><i>dname</i><b>, int</b>
<i>class</i><b>, int</b> <i>type</i><b>, <br>
unsigned char *</b><i>answer</i><b>, int</b>
<i>anslen</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
res_querydomain(const char *</b><i>name</i><b>, const char
*</b><i>domain</i><b>, <br>
int</b> <i>class</i><b>, int</b> <i>type</i><b>, unsigned
char *</b><i>answer</i><b>, <br>
int</b> <i>anslen</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
res_mkquery(int</b> <i>op</i><b>, const char
*</b><i>dname</i><b>, int</b> <i>class</i><b>, <br>
int</b> <i>type</i><b>, const unsigned char
*</b><i>data</i><b>, int</b> <i>datalen</i><b>, <br>
const unsigned char *</b><i>newrr</i><b>, <br>
unsigned char *</b><i>buf</i><b>, int</b>
<i>buflen</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em"><b>int
res_send(const unsigned char *</b><i>msg</i><b>, int</b>
<i>msglen</i><b>, <br>
unsigned char *</b><i>answer</i><b>, int</b>
<i>anslen</i><b>);</b></p>

<p style="margin-left:11%; margin-top: 1em">Link with
<i>-lresolv</i>.</p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>Note:</b>
This page is incomplete (various resolver functions provided
by glibc are not described) and likely out of date.</p>

<p style="margin-left:11%; margin-top: 1em">The functions
described below make queries to and interpret the responses
from Internet domain name servers.</p>

<p style="margin-left:11%; margin-top: 1em">The API
consists of a set of more modern, reentrant functions and an
older set of nonreentrant functions that have been
superseded. The traditional resolver interfaces such as
<b>res_init</b>() and <b>res_query</b>() use some static
(global) state stored in the <i>_res</i> structure,
rendering these functions non-thread-safe. BIND 8.2
introduced a set of new interfaces <b>res_ninit</b>(),
<b>res_nquery</b>(), and so on, which take a
<i>res_state</i> as their first argument, so you can use a
per-thread resolver state.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>res_ninit</b>() and <b>res_init</b>() functions read the
configuration files (see <b>resolv.conf</b>(5)) to get the
default domain name and name server address(es). If no
server is given, the local host is tried. If no domain is
given, that associated with the local host is used. It can
be overridden with the environment variable
<b>LOCALDOMAIN</b>. <b>res_ninit</b>() or <b>res_init</b>()
is normally executed by the first call to one of the other
functions. Every call to <b>res_ninit</b>() requires a
corresponding call to <b>res_nclose</b>() to free memory
allocated by <b>res_ninit</b>() and subsequent calls to
<b>res_nquery</b>().</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>res_nquery</b>() and <b>res_query</b>() functions query
the name server for the fully qualified domain name
<i>name</i> of specified <i>type</i> and <i>class</i>. The
reply is left in the buffer <i>answer</i> of length
<i>anslen</i> supplied by the caller.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>res_nsearch</b>() and <b>res_search</b>() functions make
a query and waits for the response like <b>res_nquery</b>()
and <b>res_query</b>(), but in addition they implement the
default and search rules controlled by <b>RES_DEFNAMES</b>
and <b>RES_DNSRCH</b> (see description of <i>_res</i>
options below).</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>res_nquerydomain</b>() and <b>res_querydomain</b>()
functions make a query using
<b>res_nquery</b>()/<b>res_query</b>() on the concatenation
of <i>name</i> and <i>domain</i>.</p>

<p style="margin-left:11%; margin-top: 1em">The following
functions are lower-level routines used by
<b>res_nquery</b>()/<b>res_query</b>().</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>res_nmkquery</b>() and <b>res_mkquery</b>() functions
construct a query message in <i>buf</i> of length
<i>buflen</i> for the domain name <i>dname</i>. The query
type <i>op</i> is one of the following (typically
<b>QUERY</b>):</p>

<table width="100%" border="0" rules="none" frame="void"
       cellspacing="0" cellpadding="0">
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>QUERY</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>Standard query.</p></td></tr>
<tr valign="top" align="left">
<td width="11%"></td>
<td width="9%">


<p><b>IQUERY</b></p></td>
<td width="2%"></td>
<td width="78%">


<p>Inverse query. This option was removed in glibc 2.26,
since it has not been supported by DNS servers for a very
long time.</p></td></tr>
</table>

<p style="margin-left:11%;"><b>NS_NOTIFY_OP</b></p>

<p style="margin-left:22%;">Notify secondary of SOA (Start
of Authority) change.</p>

<p style="margin-left:11%; margin-top: 1em"><i>newrr</i> is
currently unused.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>res_nsend</b>() and <b>res_send</b>() function send a
preformatted query given in <i>msg</i> of length
<i>msglen</i> and returns the answer in <i>answer</i> which
is of length <i>anslen</i>. They will call
<b>res_ninit</b>()/<b>res_init</b>() if it has not already
been called.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>dn_comp</b>() function compresses the domain name
<i>exp_dn</i> and stores it in the buffer <i>comp_dn</i> of
length <i>length</i>. The compression uses an array of
pointers <i>dnptrs</i> to previously compressed names in the
current message. The first pointer points to the beginning
of the message and the list ends with NULL. The limit of the
array is specified by <i>lastdnptr</i>. If <i>dnptr</i> is
NULL, domain names are not compressed. If <i>lastdnptr</i>
is NULL, the list of labels is not updated.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>dn_expand</b>() function expands the compressed domain
name <i>comp_dn</i> to a full domain name, which is placed
in the buffer <i>exp_dn</i> of size <i>length</i>. The
compressed name is contained in a query or reply message,
and <i>msg</i> points to the beginning of the message.</p>

<p style="margin-left:11%; margin-top: 1em">The resolver
routines use configuration and state information contained
in a <i>__res_state</i> structure (either passed as the
<i>statep</i> argument, or in the global variable
<i>_res</i>, in the case of the older nonreentrant
functions). The only field of this structure that is
normally manipulated by the user is the <i>options</i>
field. This field can contain the bitwise &quot;OR&quot; of
the following options: <b><br>
RES_INIT</b></p>

<p style="margin-left:22%;">True if <b>res_ninit</b>() or
<b>res_init</b>() has been called.</p>

<p style="margin-left:11%;"><b>RES_DEBUG</b></p>

<p style="margin-left:22%;">Print debugging messages. This
option is available only if glibc was built with debugging
enabled, which is not the default.</p>

<p style="margin-left:11%;"><b>RES_AAONLY</b>
(unimplemented; deprecated in glibc 2.25)</p>

<p style="margin-left:22%;">Accept authoritative answers
only. <b>res_send</b>() continues until it finds an
authoritative answer or returns an error. This option was
present but unimplemented in glibc until version 2.24; since
glibc 2.25, it is deprecated, and its usage produces a
warning.</p>

<p style="margin-left:11%;"><b>RES_USEVC</b></p>

<p style="margin-left:22%;">Use TCP connections for queries
rather than UDP datagrams.</p>

<p style="margin-left:11%;"><b>RES_PRIMARY</b>
(unimplemented; deprecated in glibc 2.25)</p>

<p style="margin-left:22%;">Query primary domain name
server only. This option was present but unimplemented in
glibc until version 2.24; since glibc 2.25, it is
deprecated, and its usage produces a warning.</p>

<p style="margin-left:11%;"><b>RES_IGNTC</b></p>

<p style="margin-left:22%;">Ignore truncation errors.
Don&rsquo;t retry with TCP.</p>

<p style="margin-left:11%;"><b>RES_RECURSE</b></p>

<p style="margin-left:22%;">Set the recursion desired bit
in queries. Recursion is carried out by the domain name
server, not by <b>res_send</b>(). [Enabled by default].</p>

<p style="margin-left:11%;"><b>RES_DEFNAMES</b></p>

<p style="margin-left:22%;">If set, <b>res_search</b>()
will append the default domain name to single component
names&mdash;that is, those that do not contain a dot.
[Enabled by default].</p>

<p style="margin-left:11%;"><b>RES_STAYOPEN</b></p>

<p style="margin-left:22%;">Used with <b>RES_USEVC</b> to
keep the TCP connection open between queries.</p>

<p style="margin-left:11%;"><b>RES_DNSRCH</b></p>

<p style="margin-left:22%;">If set, <b>res_search</b>()
will search for hostnames in the current domain and in
parent domains. This option is used by
<b>gethostbyname</b>(3). [Enabled by default].</p>

<p style="margin-left:11%;"><b>RES_INSECURE1</b></p>

<p style="margin-left:22%;">Accept a response from a wrong
server. This can be used to detect potential security
hazards, but you need to compile glibc with debugging
enabled and use <b>RES_DEBUG</b> option (for debug purpose
only).</p>

<p style="margin-left:11%;"><b>RES_INSECURE2</b></p>

<p style="margin-left:22%;">Accept a response which
contains a wrong query. This can be used to detect potential
security hazards, but you need to compile glibc with
debugging enabled and use <b>RES_DEBUG</b> option (for debug
purpose only).</p>

<p style="margin-left:11%;"><b>RES_NOALIASES</b></p>

<p style="margin-left:22%;">Disable usage of
<b>HOSTALIASES</b> environment variable.</p>

<p style="margin-left:11%;"><b>RES_USE_INET6</b></p>

<p style="margin-left:22%;">Try an AAAA query before an A
query inside the <b>gethostbyname</b>(3) function, and map
IPv4 responses in IPv6 &quot;tunneled form&quot; if no AAAA
records are found but an A record set exists. Since glibc
2.25, this option is deprecated, and its usage produces a
warning; applications should use <b>getaddrinfo</b>(3),
rather than <b>gethostbyname</b>(3).</p>

<p style="margin-left:11%;"><b>RES_ROTATE</b></p>

<p style="margin-left:22%;">Causes round-robin selection of
name servers from among those listed. This has the effect of
spreading the query load among all listed servers, rather
than having all clients try the first listed server first
every time.</p>

<p style="margin-left:11%;"><b>RES_NOCHECKNAME</b>
(unimplemented; deprecated in glibc 2.25)</p>

<p style="margin-left:22%;">Disable the modern BIND
checking of incoming hostnames and mail names for invalid
characters such as underscore (_), non-ASCII, or control
characters. This option was present in glibc until version
2.24; since glibc 2.25, it is deprecated, and its usage
produces a warning.</p>

<p style="margin-left:11%;"><b>RES_KEEPTSIG</b>
(unimplemented; deprecated in glibc 2.25)</p>

<p style="margin-left:22%;">Do not strip TSIG records. This
option was present but unimplemented in glibc until version
2.24; since glibc 2.25, it is deprecated, and its usage
produces a warning.</p>

<p style="margin-left:11%;"><b>RES_BLAST</b>
(unimplemented; deprecated in glibc 2.25)</p>

<p style="margin-left:22%;">Send each query simultaneously
and recursively to all servers. This option was present but
unimplemented in glibc until version 2.24; since glibc 2.25,
it is deprecated, and its usage produces a warning.</p>

<p style="margin-left:11%;"><b>RES_USEBSTRING</b> (glibc
2.3.4 to 2.24)</p>

<p style="margin-left:22%;">Make reverse IPv6 lookups using
the bit-label format described in RFC 2673; if this option
is not set (which is the default), then nibble format is
used. This option was removed in glibc 2.25, since it relied
on a backward-incompatible DNS extension that was never
deployed on the Internet.</p>

<p style="margin-left:11%;"><b>RES_NOIP6DOTINT</b> (glibc
2.24 and earlier)</p>

<p style="margin-left:22%;">Use <i>ip6.arpa</i> zone in
IPv6 reverse lookup instead of <i>ip6.int</i>, which is
deprecated since glibc 2.3.4. This option is present in
glibc up to and including version 2.24, where it is enabled
by default. In glibc 2.25, this option was removed.</p>

<p style="margin-left:11%;"><b>RES_USE_EDNS0</b> (since
glibc 2.6)</p>

<p style="margin-left:22%;">Enables support for the DNS
extensions (EDNS0) described in RFC 2671.</p>

<p style="margin-left:11%;"><b>RES_SNGLKUP</b> (since glibc
2.10)</p>

<p style="margin-left:22%;">By default, glibc performs IPv4
and IPv6 lookups in parallel since version 2.9. Some
appliance DNS servers cannot handle these queries properly
and make the requests time out. This option disables the
behavior and makes glibc perform the IPv6 and IPv4 requests
sequentially (at the cost of some slowdown of the resolving
process).</p>

<p style="margin-left:11%;"><b>RES_SNGLKUPREOP</b></p>

<p style="margin-left:22%;">When <b>RES_SNGLKUP</b> option
is enabled, opens a new socket for the each request.</p>

<p style="margin-left:11%;"><b>RES_USE_DNSSEC</b></p>

<p style="margin-left:22%;">Use DNSSEC with OK bit in OPT
record. This option implies <b>RES_USE_EDNS0</b>.</p>

<p style="margin-left:11%;"><b>RES_NOTLDQUERY</b></p>

<p style="margin-left:22%;">Do not look up unqualified name
as a top-level domain (TLD).</p>

<p style="margin-left:11%;"><b>RES_DEFAULT</b></p>

<p style="margin-left:22%;">Default option which implies:
<b>RES_RECURSE</b>, <b>RES_DEFNAMES</b>, <b>RES_DNSRCH</b>,
and <b>RES_NOIP6DOTINT</b>.</p>

<h2>RETURN VALUE
<a name="RETURN VALUE"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">The
<b>res_ninit</b>() and <b>res_init</b>() functions return 0
on success, or -1 if an error occurs.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>res_nquery</b>(), <b>res_query</b>(),
<b>res_nsearch</b>(), <b>res_search</b>(),
<b>res_nquerydomain</b>(), <b>res_querydomain</b>(),
<b>res_nmkquery</b>(), <b>res_mkquery</b>(),
<b>res_nsend</b>(), and <b>res_send</b>() functions return
the length of the response, or -1 if an error occurs.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>dn_comp</b>() and <b>dn_expand</b>() functions return the
length of the compressed name, or -1 if an error occurs.</p>

<p style="margin-left:11%; margin-top: 1em">In the case of
an error return from <b>res_nquery</b>(),
<b>res_query</b>(), <b>res_nsearch</b>(),
<b>res_search</b>(), <b>res_nquerydomain</b>(), or
<b>res_querydomain</b>(), the global variable <i>h_errno</i>
(see <b>gethostbyname</b>(3)) can be consulted to determine
the cause of the error.</p>

<h2>FILES
<a name="FILES"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><i>/etc/resolv.conf</i></p>

<p style="margin-left:22%;">resolver configuration file</p>

<p style="margin-left:11%;"><i>/etc/host.conf</i></p>

<p style="margin-left:22%;">resolver configuration file</p>

<h2>ATTRIBUTES
<a name="ATTRIBUTES"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">For an
explanation of the terms used in this section, see
<b>attributes</b>(7).</p>


<p align="center" style="margin-top: 1em"><img src="grohtml-3303211.png" alt="Image grohtml-3303211.png"></p>

<h2>CONFORMING TO
<a name="CONFORMING TO"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">4.3BSD.</p>

<h2>SEE ALSO
<a name="SEE ALSO"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>gethostbyname</b>(3),
<b>resolv.conf</b>(5), <b>resolver</b>(5),
<b>hostname</b>(7), <b>named</b>(8)</p>

<p style="margin-left:11%; margin-top: 1em">The GNU C
library source file <i>resolv/README</i>.</p>

<h2>COLOPHON
<a name="COLOPHON"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This page is
part of release 5.10 of the Linux <i>man-pages</i> project.
A description of the project, information about reporting
bugs, and the latest version of this page, can be found at
https://www.kernel.org/doc/man-pages/.</p>
<hr>
</body>
</html>
